// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`ApiStage snapshot 1`] = `
Object {
  "Outputs": Object {
    "ExportsOutputFnGetAttkmskey6257DE3DArnF7CD15EC": Object {
      "Export": Object {
        "Name": "api-stage-snapshot-key-stack:ExportsOutputFnGetAttkmskey6257DE3DArnF7CD15EC",
      },
      "Value": Object {
        "Fn::GetAtt": Array [
          "kmskey6257DE3D",
          "Arn",
        ],
      },
    },
  },
  "Parameters": Object {
    "BootstrapVersion": Object {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": Object {
    "kmskey6257DE3D": Object {
      "DeletionPolicy": "Retain",
      "Properties": Object {
        "Description": "encryption key for irma-issue-app",
        "EnableKeyRotation": true,
        "KeyPolicy": Object {
          "Statement": Array [
            Object {
              "Action": "kms:*",
              "Effect": "Allow",
              "Principal": Object {
                "AWS": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::",
                      Object {
                        "Ref": "AWS::AccountId",
                      },
                      ":root",
                    ],
                  ],
                },
              },
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::KMS::Key",
      "UpdateReplacePolicy": "Retain",
    },
    "kmskeyAlias78F320A9": Object {
      "Properties": Object {
        "AliasName": "alias/irma-issue-app/userdata",
        "TargetKeyId": Object {
          "Fn::GetAtt": Array [
            "kmskey6257DE3D",
            "Arn",
          ],
        },
      },
      "Type": "AWS::KMS::Alias",
    },
    "ssmsessions13C58A2BA": Object {
      "Properties": Object {
        "Name": "/cdk/irma-issue-app/kms-datakey-arn",
        "Type": "String",
        "Value": Object {
          "Fn::GetAtt": Array [
            "kmskey6257DE3D",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
  },
  "Rules": Object {
    "CheckBootstrapVersion": Object {
      "Assertions": Array [
        Object {
          "Assert": Object {
            "Fn::Not": Array [
              Object {
                "Fn::Contains": Array [
                  Array [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  Object {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`ApiStage snapshot 2`] = `
Object {
  "Outputs": Object {
    "ExportsOutputFnGetAttsessionstable9FEB2915Arn94F05FDE": Object {
      "Export": Object {
        "Name": "api-stage-snapshot-sessions-stack:ExportsOutputFnGetAttsessionstable9FEB2915Arn94F05FDE",
      },
      "Value": Object {
        "Fn::GetAtt": Array [
          "sessionstable9FEB2915",
          "Arn",
        ],
      },
    },
    "ExportsOutputRefsessionstable9FEB29154441788E": Object {
      "Export": Object {
        "Name": "api-stage-snapshot-sessions-stack:ExportsOutputRefsessionstable9FEB29154441788E",
      },
      "Value": Object {
        "Ref": "sessionstable9FEB2915",
      },
    },
  },
  "Parameters": Object {
    "BootstrapVersion": Object {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": Object {
    "sessionstable9FEB2915": Object {
      "DeletionPolicy": "Retain",
      "Properties": Object {
        "AttributeDefinitions": Array [
          Object {
            "AttributeName": "sessionid",
            "AttributeType": "S",
          },
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "KeySchema": Array [
          Object {
            "AttributeName": "sessionid",
            "KeyType": "HASH",
          },
        ],
        "SSESpecification": Object {
          "KMSMasterKeyId": Object {
            "Fn::ImportValue": "api-stage-snapshot-key-stack:ExportsOutputFnGetAttkmskey6257DE3DArnF7CD15EC",
          },
          "SSEEnabled": true,
          "SSEType": "KMS",
        },
        "TableName": "irma-issue-sessions",
        "TimeToLiveSpecification": Object {
          "AttributeName": "ttl",
          "Enabled": true,
        },
      },
      "Type": "AWS::DynamoDB::Table",
      "UpdateReplacePolicy": "Retain",
    },
    "ssmsessions13C58A2BA": Object {
      "Properties": Object {
        "Name": "/cdk/irma-issue-app/sessionstable-arn",
        "Type": "String",
        "Value": Object {
          "Fn::GetAtt": Array [
            "sessionstable9FEB2915",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
  },
  "Rules": Object {
    "CheckBootstrapVersion": Object {
      "Assertions": Array [
        Object {
          "Assert": Object {
            "Fn::Not": Array [
              Object {
                "Fn::Contains": Array [
                  Array [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  Object {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`ApiStage snapshot 3`] = `
Object {
  "Parameters": Object {
    "BootstrapVersion": Object {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuegemeentenijmegenaccounthostedzoneidC96584B6F00A464EAD1953AFF4B05118Parameter": Object {
      "Default": "/gemeente-nijmegen/account/hostedzone/id",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuegemeentenijmegenaccounthostedzonenameC96584B6F00A464EAD1953AFF4B05118Parameter": Object {
      "Default": "/gemeente-nijmegen/account/hostedzone/name",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": Object {
    "hostedzone0562BB58": Object {
      "Properties": Object {
        "Name": Object {
          "Fn::Join": Array [
            "",
            Array [
              "irma-issue.",
              Object {
                "Ref": "SsmParameterValuegemeentenijmegenaccounthostedzonenameC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
              ".",
            ],
          ],
        },
      },
      "Type": "AWS::Route53::HostedZone",
    },
    "hostedzoneid1AC4B18C": Object {
      "Properties": Object {
        "Name": "/cdk/irma-issue-app/zone/id",
        "Type": "String",
        "Value": Object {
          "Ref": "hostedzone0562BB58",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "hostedzonenameD77D0DBE": Object {
      "Properties": Object {
        "Name": "/cdk/irma-issue-app/zone/name",
        "Type": "String",
        "Value": Object {
          "Fn::Join": Array [
            "",
            Array [
              "irma-issue.",
              Object {
                "Ref": "SsmParameterValuegemeentenijmegenaccounthostedzonenameC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
            ],
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "nsrecord7FD33D64": Object {
      "Properties": Object {
        "HostedZoneId": Object {
          "Ref": "SsmParameterValuegemeentenijmegenaccounthostedzoneidC96584B6F00A464EAD1953AFF4B05118Parameter",
        },
        "Name": Object {
          "Fn::Join": Array [
            "",
            Array [
              "irma-issue.",
              Object {
                "Ref": "SsmParameterValuegemeentenijmegenaccounthostedzonenameC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
              ".",
            ],
          ],
        },
        "ResourceRecords": Object {
          "Fn::GetAtt": Array [
            "hostedzone0562BB58",
            "NameServers",
          ],
        },
        "TTL": "1800",
        "Type": "NS",
      },
      "Type": "AWS::Route53::RecordSet",
    },
  },
  "Rules": Object {
    "CheckBootstrapVersion": Object {
      "Assertions": Array [
        Object {
          "Assert": Object {
            "Fn::Not": Array [
              Object {
                "Fn::Contains": Array [
                  Array [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  Object {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`ApiStage snapshot 4`] = `
Object {
  "Parameters": Object {
    "BootstrapVersion": Object {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": Object {
    "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A": Object {
      "DependsOn": Array [
        "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB",
        "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB",
      ],
      "Properties": Object {
        "Code": Object {
          "S3Bucket": Object {
            "Fn::Sub": "cdk-hnb659fds-assets-\${AWS::AccountId}-us-east-1",
          },
          "S3Key": "eb5b005c858404ea0c8f68098ed5dcdf5340e02461f149751d10f59c210d5ef8.zip",
        },
        "Handler": "index.handler",
        "Role": Object {
          "Fn::GetAtt": Array [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB",
            "Arn",
          ],
        },
        "Runtime": "nodejs14.x",
      },
      "Type": "AWS::Lambda::Function",
    },
    "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": Array [
                "logs:PutRetentionPolicy",
                "logs:DeleteRetentionPolicy",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB",
        "Roles": Array [
          Object {
            "Ref": "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "certarn063A669C": Object {
      "Properties": Object {
        "Name": "/cdk/irma-issue-app/certificates/certificate-arn",
        "Type": "String",
        "Value": Object {
          "Ref": "certificateEC031123",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "certificateEC031123": Object {
      "Properties": Object {
        "DomainName": Object {
          "Fn::GetAtt": Array [
            "zoneparamsSsmParametersF6CC8160",
            "/cdk/irma-issue-app/zone/name",
          ],
        },
        "DomainValidationOptions": Array [
          Object {
            "DomainName": Object {
              "Fn::GetAtt": Array [
                "zoneparamsSsmParametersF6CC8160",
                "/cdk/irma-issue-app/zone/name",
              ],
            },
            "HostedZoneId": Object {
              "Fn::GetAtt": Array [
                "zoneparamsSsmParametersF6CC8160",
                "/cdk/irma-issue-app/zone/id",
              ],
            },
          },
          Object {
            "DomainName": "snapshot-tests.nijmegen.nl",
            "HostedZoneId": Object {
              "Fn::GetAtt": Array [
                "zoneparamsSsmParametersF6CC8160",
                "/cdk/irma-issue-app/zone/id",
              ],
            },
          },
        ],
        "SubjectAlternativeNames": Array [
          "snapshot-tests.nijmegen.nl",
        ],
        "Tags": Array [
          Object {
            "Key": "Name",
            "Value": "api-stage-snapshot/us-cert-stack/certificate",
          },
        ],
        "ValidationMethod": "DNS",
      },
      "Type": "AWS::CertificateManager::Certificate",
    },
    "zoneparamsMyHandler86FC9CD9": Object {
      "DependsOn": Array [
        "zoneparamsMyHandlerServiceRoleDefaultPolicy67632765",
        "zoneparamsMyHandlerServiceRole973E2CB4",
      ],
      "Properties": Object {
        "Code": Object {
          "S3Bucket": Object {
            "Fn::Sub": "cdk-hnb659fds-assets-\${AWS::AccountId}-us-east-1",
          },
          "S3Key": "3803df2f6849acf50bb6577ee095a669940670e799f70a2be34893a399777bc3.zip",
        },
        "Handler": "remote-parameters.on_event",
        "Role": Object {
          "Fn::GetAtt": Array [
            "zoneparamsMyHandlerServiceRole973E2CB4",
            "Arn",
          ],
        },
        "Runtime": "python3.8",
      },
      "Type": "AWS::Lambda::Function",
    },
    "zoneparamsMyHandlerServiceRole973E2CB4": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "zoneparamsMyHandlerServiceRoleDefaultPolicy67632765": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "ssm:GetParametersByPath",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "zoneparamsMyHandlerServiceRoleDefaultPolicy67632765",
        "Roles": Array [
          Object {
            "Ref": "zoneparamsMyHandlerServiceRole973E2CB4",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "zoneparamsMyProviderframeworkonEventBF714C35": Object {
      "DependsOn": Array [
        "zoneparamsMyProviderframeworkonEventServiceRoleDefaultPolicy48727A09",
        "zoneparamsMyProviderframeworkonEventServiceRole1B3019D2",
      ],
      "Properties": Object {
        "Code": Object {
          "S3Bucket": Object {
            "Fn::Sub": "cdk-hnb659fds-assets-\${AWS::AccountId}-us-east-1",
          },
          "S3Key": "2157f4ab8972014e220d70707296b292b3b7301f163f7cd641ccda0ee663530f.zip",
        },
        "Description": "AWS CDK resource provider framework - onEvent (api-stage-snapshot/us-cert-stack/zone-params/MyProvider)",
        "Environment": Object {
          "Variables": Object {
            "USER_ON_EVENT_FUNCTION_ARN": Object {
              "Fn::GetAtt": Array [
                "zoneparamsMyHandler86FC9CD9",
                "Arn",
              ],
            },
          },
        },
        "Handler": "framework.onEvent",
        "Role": Object {
          "Fn::GetAtt": Array [
            "zoneparamsMyProviderframeworkonEventServiceRole1B3019D2",
            "Arn",
          ],
        },
        "Runtime": "nodejs14.x",
        "Timeout": 900,
      },
      "Type": "AWS::Lambda::Function",
    },
    "zoneparamsMyProviderframeworkonEventLogRetention72A02004": Object {
      "Properties": Object {
        "LogGroupName": Object {
          "Fn::Join": Array [
            "",
            Array [
              "/aws/lambda/",
              Object {
                "Ref": "zoneparamsMyProviderframeworkonEventBF714C35",
              },
            ],
          ],
        },
        "RetentionInDays": 1,
        "ServiceToken": Object {
          "Fn::GetAtt": Array [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "zoneparamsMyProviderframeworkonEventServiceRole1B3019D2": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "zoneparamsMyProviderframeworkonEventServiceRoleDefaultPolicy48727A09": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": Array [
                Object {
                  "Fn::GetAtt": Array [
                    "zoneparamsMyHandler86FC9CD9",
                    "Arn",
                  ],
                },
                Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      Object {
                        "Fn::GetAtt": Array [
                          "zoneparamsMyHandler86FC9CD9",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "zoneparamsMyProviderframeworkonEventServiceRoleDefaultPolicy48727A09",
        "Roles": Array [
          Object {
            "Ref": "zoneparamsMyProviderframeworkonEventServiceRole1B3019D2",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "zoneparamsSsmParametersF6CC8160": Object {
      "DeletionPolicy": "Delete",
      "Properties": Object {
        "ServiceToken": Object {
          "Fn::GetAtt": Array [
            "zoneparamsMyProviderframeworkonEventBF714C35",
            "Arn",
          ],
        },
        "parameterPath": "/cdk/irma-issue-app/zone",
        "regionName": "eu-central-1",
        "stackName": "api-stage-snapshot-us-cert-stack",
      },
      "Type": "AWS::CloudFormation::CustomResource",
      "UpdateReplacePolicy": "Delete",
    },
  },
  "Rules": Object {
    "CheckBootstrapVersion": Object {
      "Assertions": Array [
        Object {
          "Assert": Object {
            "Fn::Not": Array [
              Object {
                "Fn::Contains": Array [
                  Array [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  Object {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`ApiStage snapshot 5`] = `
Object {
  "Parameters": Object {
    "BootstrapVersion": Object {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuegemeentenijmegenaccountdnsseckmskeyarnC96584B6F00A464EAD1953AFF4B05118Parameter": Object {
      "Default": "/gemeente-nijmegen/account/dnssec/kmskey/arn",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": Object {
    "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A": Object {
      "DependsOn": Array [
        "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB",
        "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB",
      ],
      "Properties": Object {
        "Code": Object {
          "S3Bucket": Object {
            "Fn::Sub": "cdk-hnb659fds-assets-\${AWS::AccountId}-us-east-1",
          },
          "S3Key": "eb5b005c858404ea0c8f68098ed5dcdf5340e02461f149751d10f59c210d5ef8.zip",
        },
        "Handler": "index.handler",
        "Role": Object {
          "Fn::GetAtt": Array [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB",
            "Arn",
          ],
        },
        "Runtime": "nodejs14.x",
      },
      "Type": "AWS::Lambda::Function",
    },
    "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": Array [
                "logs:PutRetentionPolicy",
                "logs:DeleteRetentionPolicy",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB",
        "Roles": Array [
          Object {
            "Ref": "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "dnssec": Object {
      "DependsOn": Array [
        "dnsseckeysigningkey",
      ],
      "Properties": Object {
        "HostedZoneId": Object {
          "Fn::GetAtt": Array [
            "zoneparamsSsmParametersF6CC8160",
            "/cdk/irma-issue-app/zone/id",
          ],
        },
      },
      "Type": "AWS::Route53::DNSSEC",
    },
    "dnsseckeysigningkey": Object {
      "Properties": Object {
        "HostedZoneId": Object {
          "Fn::GetAtt": Array [
            "zoneparamsSsmParametersF6CC8160",
            "/cdk/irma-issue-app/zone/id",
          ],
        },
        "KeyManagementServiceArn": Object {
          "Ref": "SsmParameterValuegemeentenijmegenaccountdnsseckmskeyarnC96584B6F00A464EAD1953AFF4B05118Parameter",
        },
        "Name": "irma_issue_ksk",
        "Status": "ACTIVE",
      },
      "Type": "AWS::Route53::KeySigningKey",
    },
    "dnssecrecordcustomresource8F10C2F6": Object {
      "DeletionPolicy": "Delete",
      "DependsOn": Array [
        "dnssec",
      ],
      "Properties": Object {
        "ServiceToken": Object {
          "Fn::GetAtt": Array [
            "dnssecrecordproviderframeworkonEvent8EF81F08",
            "Arn",
          ],
        },
        "hostedZoneId": Object {
          "Fn::GetAtt": Array [
            "zoneparamsSsmParametersF6CC8160",
            "/cdk/irma-issue-app/zone/id",
          ],
        },
        "hostedZoneName": Object {
          "Fn::GetAtt": Array [
            "zoneparamsSsmParametersF6CC8160",
            "/cdk/irma-issue-app/zone/name",
          ],
        },
        "keySigningKeyName": "irma_issue_ksk",
        "parentHostedZoneId": Object {
          "Fn::GetAtt": Array [
            "rootzoneparamsSsmParameters799A10AA",
            "/gemeente-nijmegen/account/hostedzone/id",
          ],
        },
      },
      "Type": "AWS::CloudFormation::CustomResource",
      "UpdateReplacePolicy": "Delete",
    },
    "dnssecrecordlambda74E5C966": Object {
      "DependsOn": Array [
        "dnssec",
        "dnssecrecordlambdaServiceRoleDefaultPolicyD2FEB526",
        "dnssecrecordlambdaServiceRoleAB09F568",
      ],
      "Properties": Object {
        "Code": Object {
          "S3Bucket": Object {
            "Fn::Sub": "cdk-hnb659fds-assets-\${AWS::AccountId}-us-east-1",
          },
          "S3Key": "04aae5aa9e9ed5e0aeefb4bbbfb82449ef35f3db68a98770c2e5cc4237666963.zip",
        },
        "Description": "src/dnssec-record/dnssec-record.lambda.ts",
        "Environment": Object {
          "Variables": Object {
            "AWS_NODEJS_CONNECTION_REUSE_ENABLED": "1",
          },
        },
        "Handler": "index.handler",
        "Role": Object {
          "Fn::GetAtt": Array [
            "dnssecrecordlambdaServiceRoleAB09F568",
            "Arn",
          ],
        },
        "Runtime": "nodejs14.x",
        "Timeout": 60,
      },
      "Type": "AWS::Lambda::Function",
    },
    "dnssecrecordlambdaServiceRoleAB09F568": Object {
      "DependsOn": Array [
        "dnssec",
      ],
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "dnssecrecordlambdaServiceRoleDefaultPolicyD2FEB526": Object {
      "DependsOn": Array [
        "dnssec",
      ],
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "route53:GetChange",
              "Effect": "Allow",
              "Resource": "*",
            },
            Object {
              "Action": "route53:GetDNSSEC",
              "Effect": "Allow",
              "Resource": Object {
                "Fn::Join": Array [
                  "",
                  Array [
                    "arn:",
                    Object {
                      "Ref": "AWS::Partition",
                    },
                    ":route53:::hostedzone/",
                    Object {
                      "Fn::GetAtt": Array [
                        "zoneparamsSsmParametersF6CC8160",
                        "/cdk/irma-issue-app/zone/id",
                      ],
                    },
                  ],
                ],
              },
            },
            Object {
              "Action": "route53:ChangeResourceRecordSets",
              "Effect": "Allow",
              "Resource": Object {
                "Fn::Join": Array [
                  "",
                  Array [
                    "arn:",
                    Object {
                      "Ref": "AWS::Partition",
                    },
                    ":route53:::hostedzone/",
                    Object {
                      "Fn::GetAtt": Array [
                        "rootzoneparamsSsmParameters799A10AA",
                        "/gemeente-nijmegen/account/hostedzone/id",
                      ],
                    },
                  ],
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "dnssecrecordlambdaServiceRoleDefaultPolicyD2FEB526",
        "Roles": Array [
          Object {
            "Ref": "dnssecrecordlambdaServiceRoleAB09F568",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "dnssecrecordproviderframeworkonEvent8EF81F08": Object {
      "DependsOn": Array [
        "dnssec",
        "dnssecrecordproviderframeworkonEventServiceRoleDefaultPolicyCC931F8E",
        "dnssecrecordproviderframeworkonEventServiceRoleE3750F55",
      ],
      "Properties": Object {
        "Code": Object {
          "S3Bucket": Object {
            "Fn::Sub": "cdk-hnb659fds-assets-\${AWS::AccountId}-us-east-1",
          },
          "S3Key": "2157f4ab8972014e220d70707296b292b3b7301f163f7cd641ccda0ee663530f.zip",
        },
        "Description": "AWS CDK resource provider framework - onEvent (api-stage-snapshot/dnssec-stack/dnssec-record/provider)",
        "Environment": Object {
          "Variables": Object {
            "USER_ON_EVENT_FUNCTION_ARN": Object {
              "Fn::GetAtt": Array [
                "dnssecrecordlambda74E5C966",
                "Arn",
              ],
            },
          },
        },
        "Handler": "framework.onEvent",
        "Role": Object {
          "Fn::GetAtt": Array [
            "dnssecrecordproviderframeworkonEventServiceRoleE3750F55",
            "Arn",
          ],
        },
        "Runtime": "nodejs14.x",
        "Timeout": 900,
      },
      "Type": "AWS::Lambda::Function",
    },
    "dnssecrecordproviderframeworkonEventLogRetention42683AC3": Object {
      "DependsOn": Array [
        "dnssec",
      ],
      "Properties": Object {
        "LogGroupName": Object {
          "Fn::Join": Array [
            "",
            Array [
              "/aws/lambda/",
              Object {
                "Ref": "dnssecrecordproviderframeworkonEvent8EF81F08",
              },
            ],
          ],
        },
        "RetentionInDays": 30,
        "ServiceToken": Object {
          "Fn::GetAtt": Array [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "dnssecrecordproviderframeworkonEventServiceRoleDefaultPolicyCC931F8E": Object {
      "DependsOn": Array [
        "dnssec",
      ],
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": Array [
                Object {
                  "Fn::GetAtt": Array [
                    "dnssecrecordlambda74E5C966",
                    "Arn",
                  ],
                },
                Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      Object {
                        "Fn::GetAtt": Array [
                          "dnssecrecordlambda74E5C966",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "dnssecrecordproviderframeworkonEventServiceRoleDefaultPolicyCC931F8E",
        "Roles": Array [
          Object {
            "Ref": "dnssecrecordproviderframeworkonEventServiceRoleE3750F55",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "dnssecrecordproviderframeworkonEventServiceRoleE3750F55": Object {
      "DependsOn": Array [
        "dnssec",
      ],
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "rootzoneparamsMyHandlerE3D20D2F": Object {
      "DependsOn": Array [
        "rootzoneparamsMyHandlerServiceRoleDefaultPolicyCB2056C0",
        "rootzoneparamsMyHandlerServiceRoleAC00B4FB",
      ],
      "Properties": Object {
        "Code": Object {
          "S3Bucket": Object {
            "Fn::Sub": "cdk-hnb659fds-assets-\${AWS::AccountId}-us-east-1",
          },
          "S3Key": "3803df2f6849acf50bb6577ee095a669940670e799f70a2be34893a399777bc3.zip",
        },
        "Handler": "remote-parameters.on_event",
        "Role": Object {
          "Fn::GetAtt": Array [
            "rootzoneparamsMyHandlerServiceRoleAC00B4FB",
            "Arn",
          ],
        },
        "Runtime": "python3.8",
      },
      "Type": "AWS::Lambda::Function",
    },
    "rootzoneparamsMyHandlerServiceRoleAC00B4FB": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "rootzoneparamsMyHandlerServiceRoleDefaultPolicyCB2056C0": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "ssm:GetParametersByPath",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "rootzoneparamsMyHandlerServiceRoleDefaultPolicyCB2056C0",
        "Roles": Array [
          Object {
            "Ref": "rootzoneparamsMyHandlerServiceRoleAC00B4FB",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "rootzoneparamsMyProviderframeworkonEvent11A6AF7D": Object {
      "DependsOn": Array [
        "rootzoneparamsMyProviderframeworkonEventServiceRoleDefaultPolicyDE757064",
        "rootzoneparamsMyProviderframeworkonEventServiceRole853B95D5",
      ],
      "Properties": Object {
        "Code": Object {
          "S3Bucket": Object {
            "Fn::Sub": "cdk-hnb659fds-assets-\${AWS::AccountId}-us-east-1",
          },
          "S3Key": "2157f4ab8972014e220d70707296b292b3b7301f163f7cd641ccda0ee663530f.zip",
        },
        "Description": "AWS CDK resource provider framework - onEvent (api-stage-snapshot/dnssec-stack/root-zone-params/MyProvider)",
        "Environment": Object {
          "Variables": Object {
            "USER_ON_EVENT_FUNCTION_ARN": Object {
              "Fn::GetAtt": Array [
                "rootzoneparamsMyHandlerE3D20D2F",
                "Arn",
              ],
            },
          },
        },
        "Handler": "framework.onEvent",
        "Role": Object {
          "Fn::GetAtt": Array [
            "rootzoneparamsMyProviderframeworkonEventServiceRole853B95D5",
            "Arn",
          ],
        },
        "Runtime": "nodejs14.x",
        "Timeout": 900,
      },
      "Type": "AWS::Lambda::Function",
    },
    "rootzoneparamsMyProviderframeworkonEventLogRetention6AA2BD83": Object {
      "Properties": Object {
        "LogGroupName": Object {
          "Fn::Join": Array [
            "",
            Array [
              "/aws/lambda/",
              Object {
                "Ref": "rootzoneparamsMyProviderframeworkonEvent11A6AF7D",
              },
            ],
          ],
        },
        "RetentionInDays": 1,
        "ServiceToken": Object {
          "Fn::GetAtt": Array [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "rootzoneparamsMyProviderframeworkonEventServiceRole853B95D5": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "rootzoneparamsMyProviderframeworkonEventServiceRoleDefaultPolicyDE757064": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": Array [
                Object {
                  "Fn::GetAtt": Array [
                    "rootzoneparamsMyHandlerE3D20D2F",
                    "Arn",
                  ],
                },
                Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      Object {
                        "Fn::GetAtt": Array [
                          "rootzoneparamsMyHandlerE3D20D2F",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "rootzoneparamsMyProviderframeworkonEventServiceRoleDefaultPolicyDE757064",
        "Roles": Array [
          Object {
            "Ref": "rootzoneparamsMyProviderframeworkonEventServiceRole853B95D5",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "rootzoneparamsSsmParameters799A10AA": Object {
      "DeletionPolicy": "Delete",
      "Properties": Object {
        "ServiceToken": Object {
          "Fn::GetAtt": Array [
            "rootzoneparamsMyProviderframeworkonEvent11A6AF7D",
            "Arn",
          ],
        },
        "parameterPath": "/gemeente-nijmegen/account/hostedzone",
        "regionName": "eu-central-1",
        "stackName": "api-stage-snapshot-dnssec-stack",
      },
      "Type": "AWS::CloudFormation::CustomResource",
      "UpdateReplacePolicy": "Delete",
    },
    "zoneparamsMyHandler86FC9CD9": Object {
      "DependsOn": Array [
        "zoneparamsMyHandlerServiceRoleDefaultPolicy67632765",
        "zoneparamsMyHandlerServiceRole973E2CB4",
      ],
      "Properties": Object {
        "Code": Object {
          "S3Bucket": Object {
            "Fn::Sub": "cdk-hnb659fds-assets-\${AWS::AccountId}-us-east-1",
          },
          "S3Key": "3803df2f6849acf50bb6577ee095a669940670e799f70a2be34893a399777bc3.zip",
        },
        "Handler": "remote-parameters.on_event",
        "Role": Object {
          "Fn::GetAtt": Array [
            "zoneparamsMyHandlerServiceRole973E2CB4",
            "Arn",
          ],
        },
        "Runtime": "python3.8",
      },
      "Type": "AWS::Lambda::Function",
    },
    "zoneparamsMyHandlerServiceRole973E2CB4": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "zoneparamsMyHandlerServiceRoleDefaultPolicy67632765": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "ssm:GetParametersByPath",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "zoneparamsMyHandlerServiceRoleDefaultPolicy67632765",
        "Roles": Array [
          Object {
            "Ref": "zoneparamsMyHandlerServiceRole973E2CB4",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "zoneparamsMyProviderframeworkonEventBF714C35": Object {
      "DependsOn": Array [
        "zoneparamsMyProviderframeworkonEventServiceRoleDefaultPolicy48727A09",
        "zoneparamsMyProviderframeworkonEventServiceRole1B3019D2",
      ],
      "Properties": Object {
        "Code": Object {
          "S3Bucket": Object {
            "Fn::Sub": "cdk-hnb659fds-assets-\${AWS::AccountId}-us-east-1",
          },
          "S3Key": "2157f4ab8972014e220d70707296b292b3b7301f163f7cd641ccda0ee663530f.zip",
        },
        "Description": "AWS CDK resource provider framework - onEvent (api-stage-snapshot/dnssec-stack/zone-params/MyProvider)",
        "Environment": Object {
          "Variables": Object {
            "USER_ON_EVENT_FUNCTION_ARN": Object {
              "Fn::GetAtt": Array [
                "zoneparamsMyHandler86FC9CD9",
                "Arn",
              ],
            },
          },
        },
        "Handler": "framework.onEvent",
        "Role": Object {
          "Fn::GetAtt": Array [
            "zoneparamsMyProviderframeworkonEventServiceRole1B3019D2",
            "Arn",
          ],
        },
        "Runtime": "nodejs14.x",
        "Timeout": 900,
      },
      "Type": "AWS::Lambda::Function",
    },
    "zoneparamsMyProviderframeworkonEventLogRetention72A02004": Object {
      "Properties": Object {
        "LogGroupName": Object {
          "Fn::Join": Array [
            "",
            Array [
              "/aws/lambda/",
              Object {
                "Ref": "zoneparamsMyProviderframeworkonEventBF714C35",
              },
            ],
          ],
        },
        "RetentionInDays": 1,
        "ServiceToken": Object {
          "Fn::GetAtt": Array [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "zoneparamsMyProviderframeworkonEventServiceRole1B3019D2": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "zoneparamsMyProviderframeworkonEventServiceRoleDefaultPolicy48727A09": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": Array [
                Object {
                  "Fn::GetAtt": Array [
                    "zoneparamsMyHandler86FC9CD9",
                    "Arn",
                  ],
                },
                Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      Object {
                        "Fn::GetAtt": Array [
                          "zoneparamsMyHandler86FC9CD9",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "zoneparamsMyProviderframeworkonEventServiceRoleDefaultPolicy48727A09",
        "Roles": Array [
          Object {
            "Ref": "zoneparamsMyProviderframeworkonEventServiceRole1B3019D2",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "zoneparamsSsmParametersF6CC8160": Object {
      "DeletionPolicy": "Delete",
      "Properties": Object {
        "ServiceToken": Object {
          "Fn::GetAtt": Array [
            "zoneparamsMyProviderframeworkonEventBF714C35",
            "Arn",
          ],
        },
        "parameterPath": "/cdk/irma-issue-app/zone",
        "regionName": "eu-central-1",
        "stackName": "api-stage-snapshot-dnssec-stack",
      },
      "Type": "AWS::CloudFormation::CustomResource",
      "UpdateReplacePolicy": "Delete",
    },
  },
  "Rules": Object {
    "CheckBootstrapVersion": Object {
      "Assertions": Array [
        Object {
          "Assert": Object {
            "Fn::Not": Array [
              Object {
                "Fn::Contains": Array [
                  Array [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  Object {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`ApiStage snapshot 6`] = `
Object {
  "Outputs": Object {
    "ExportsOutputRefirmaissueapiD1979B651B74DB4E": Object {
      "Export": Object {
        "Name": "api-stage-snapshot-api-stack:ExportsOutputRefirmaissueapiD1979B651B74DB4E",
      },
      "Value": Object {
        "Ref": "irmaissueapiD1979B65",
      },
    },
  },
  "Parameters": Object {
    "BootstrapVersion": Object {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuecdkirmaissueappauthClientIDC96584B6F00A464EAD1953AFF4B05118Parameter": Object {
      "Default": "/cdk/irma-issue-app/authClientID",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuecdkirmaissueappauthScopeC96584B6F00A464EAD1953AFF4B05118Parameter": Object {
      "Default": "/cdk/irma-issue-app/authScope",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuecdkirmaissueappauthUrlBaseC96584B6F00A464EAD1953AFF4B05118Parameter": Object {
      "Default": "/cdk/irma-issue-app/authUrlBase",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuecdkirmaissueappbrpapiurlC96584B6F00A464EAD1953AFF4B05118Parameter": Object {
      "Default": "/cdk/irma-issue-app/brp-api-url",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuecdkirmaissueappirmaapidemoC96584B6F00A464EAD1953AFF4B05118Parameter": Object {
      "Default": "/cdk/irma-issue-app/irma-api-demo",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuecdkirmaissueappirmaapihostC96584B6F00A464EAD1953AFF4B05118Parameter": Object {
      "Default": "/cdk/irma-issue-app/irma-api-host",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuecdkirmaissueappsubjectdiversifierC96584B6F00A464EAD1953AFF4B05118Parameter": Object {
      "Default": "/cdk/irma-issue-app/subject/diversifier",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuecdkirmaissueappzonenameC96584B6F00A464EAD1953AFF4B05118Parameter": Object {
      "Default": "/cdk/irma-issue-app/zone/name",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "tlskeyParameter": Object {
      "Default": "/cdk/irma-issue-app/mtls-clientcert",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "tlsrootcaParameter": Object {
      "Default": "/cdk/irma-issue-app/mtls-rootca",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": Object {
    "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A": Object {
      "DependsOn": Array [
        "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB",
        "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB",
      ],
      "Properties": Object {
        "Code": Object {
          "S3Bucket": Object {
            "Fn::Sub": "cdk-hnb659fds-assets-\${AWS::AccountId}-\${AWS::Region}",
          },
          "S3Key": "eb5b005c858404ea0c8f68098ed5dcdf5340e02461f149751d10f59c210d5ef8.zip",
        },
        "Handler": "index.handler",
        "Role": Object {
          "Fn::GetAtt": Array [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB",
            "Arn",
          ],
        },
        "Runtime": "nodejs14.x",
      },
      "Type": "AWS::Lambda::Function",
    },
    "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": Array [
                "logs:PutRetentionPolicy",
                "logs:DeleteRetentionPolicy",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB",
        "Roles": Array [
          Object {
            "Ref": "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "irmaissueapiD1979B65": Object {
      "Properties": Object {
        "Description": "IRMA issue webapplicatie",
        "Name": "irma-issue-api",
        "ProtocolType": "HTTP",
      },
      "Type": "AWS::ApiGatewayV2::Api",
    },
    "irmaissueapiDefaultStage78125CA2": Object {
      "Properties": Object {
        "ApiId": Object {
          "Ref": "irmaissueapiD1979B65",
        },
        "AutoDeploy": true,
        "StageName": "$default",
      },
      "Type": "AWS::ApiGatewayV2::Stage",
    },
    "irmaissueapiGETauthD77F8A86": Object {
      "Properties": Object {
        "ApiId": Object {
          "Ref": "irmaissueapiD1979B65",
        },
        "AuthorizationType": "NONE",
        "RouteKey": "GET /auth",
        "Target": Object {
          "Fn::Join": Array [
            "",
            Array [
              "integrations/",
              Object {
                "Ref": "irmaissueapiGETauthirmaissueauthEA1E1136",
              },
            ],
          ],
        },
      },
      "Type": "AWS::ApiGatewayV2::Route",
    },
    "irmaissueapiGETauthirmaissueauthEA1E1136": Object {
      "Properties": Object {
        "ApiId": Object {
          "Ref": "irmaissueapiD1979B65",
        },
        "IntegrationType": "AWS_PROXY",
        "IntegrationUri": Object {
          "Fn::GetAtt": Array [
            "irmaissueauthfunctionlambda18551BF1",
            "Arn",
          ],
        },
        "PayloadFormatVersion": "2.0",
      },
      "Type": "AWS::ApiGatewayV2::Integration",
    },
    "irmaissueapiGETauthirmaissueauthPermissionEA5EE6A7": Object {
      "Properties": Object {
        "Action": "lambda:InvokeFunction",
        "FunctionName": Object {
          "Fn::GetAtt": Array [
            "irmaissueauthfunctionlambda18551BF1",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": Object {
          "Fn::Join": Array [
            "",
            Array [
              "arn:",
              Object {
                "Ref": "AWS::Partition",
              },
              ":execute-api:",
              Object {
                "Ref": "AWS::Region",
              },
              ":",
              Object {
                "Ref": "AWS::AccountId",
              },
              ":",
              Object {
                "Ref": "irmaissueapiD1979B65",
              },
              "/*/*/auth",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "irmaissueapiGETcallback37C47B93": Object {
      "Properties": Object {
        "ApiId": Object {
          "Ref": "irmaissueapiD1979B65",
        },
        "AuthorizationType": "NONE",
        "RouteKey": "GET /callback",
        "Target": Object {
          "Fn::Join": Array [
            "",
            Array [
              "integrations/",
              Object {
                "Ref": "irmaissueapiGETcallbackirmaissuesuccess9B0596CE",
              },
            ],
          ],
        },
      },
      "Type": "AWS::ApiGatewayV2::Route",
    },
    "irmaissueapiGETcallbackirmaissuesuccess9B0596CE": Object {
      "Properties": Object {
        "ApiId": Object {
          "Ref": "irmaissueapiD1979B65",
        },
        "IntegrationType": "AWS_PROXY",
        "IntegrationUri": Object {
          "Fn::GetAtt": Array [
            "irmaissuecallbackfunctionlambdaCDBC2637",
            "Arn",
          ],
        },
        "PayloadFormatVersion": "2.0",
      },
      "Type": "AWS::ApiGatewayV2::Integration",
    },
    "irmaissueapiGETcallbackirmaissuesuccessPermission267EBA75": Object {
      "Properties": Object {
        "Action": "lambda:InvokeFunction",
        "FunctionName": Object {
          "Fn::GetAtt": Array [
            "irmaissuecallbackfunctionlambdaCDBC2637",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": Object {
          "Fn::Join": Array [
            "",
            Array [
              "arn:",
              Object {
                "Ref": "AWS::Partition",
              },
              ":execute-api:",
              Object {
                "Ref": "AWS::Region",
              },
              ":",
              Object {
                "Ref": "AWS::AccountId",
              },
              ":",
              Object {
                "Ref": "irmaissueapiD1979B65",
              },
              "/*/*/callback",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "irmaissueapiGETissue6119ACCA": Object {
      "Properties": Object {
        "ApiId": Object {
          "Ref": "irmaissueapiD1979B65",
        },
        "AuthorizationType": "NONE",
        "RouteKey": "GET /issue",
        "Target": Object {
          "Fn::Join": Array [
            "",
            Array [
              "integrations/",
              Object {
                "Ref": "irmaissueapiGETissueirmaissueissue7EB19C4A",
              },
            ],
          ],
        },
      },
      "Type": "AWS::ApiGatewayV2::Route",
    },
    "irmaissueapiGETissueirmaissueissue7EB19C4A": Object {
      "Properties": Object {
        "ApiId": Object {
          "Ref": "irmaissueapiD1979B65",
        },
        "IntegrationType": "AWS_PROXY",
        "IntegrationUri": Object {
          "Fn::GetAtt": Array [
            "irmaissueissuefunctionlambda8FDA038F",
            "Arn",
          ],
        },
        "PayloadFormatVersion": "2.0",
      },
      "Type": "AWS::ApiGatewayV2::Integration",
    },
    "irmaissueapiGETissueirmaissueissuePermissionB54196E7": Object {
      "Properties": Object {
        "Action": "lambda:InvokeFunction",
        "FunctionName": Object {
          "Fn::GetAtt": Array [
            "irmaissueissuefunctionlambda8FDA038F",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": Object {
          "Fn::Join": Array [
            "",
            Array [
              "arn:",
              Object {
                "Ref": "AWS::Partition",
              },
              ":execute-api:",
              Object {
                "Ref": "AWS::Region",
              },
              ":",
              Object {
                "Ref": "AWS::AccountId",
              },
              ":",
              Object {
                "Ref": "irmaissueapiD1979B65",
              },
              "/*/*/issue",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "irmaissueapiGETlogin6EA3740C": Object {
      "Properties": Object {
        "ApiId": Object {
          "Ref": "irmaissueapiD1979B65",
        },
        "AuthorizationType": "NONE",
        "RouteKey": "GET /login",
        "Target": Object {
          "Fn::Join": Array [
            "",
            Array [
              "integrations/",
              Object {
                "Ref": "irmaissueapiGETloginirmaissuelogin82445AFC",
              },
            ],
          ],
        },
      },
      "Type": "AWS::ApiGatewayV2::Route",
    },
    "irmaissueapiGETloginirmaissuelogin82445AFC": Object {
      "Properties": Object {
        "ApiId": Object {
          "Ref": "irmaissueapiD1979B65",
        },
        "IntegrationType": "AWS_PROXY",
        "IntegrationUri": Object {
          "Fn::GetAtt": Array [
            "irmaissueloginfunctionlambda85C88306",
            "Arn",
          ],
        },
        "PayloadFormatVersion": "2.0",
      },
      "Type": "AWS::ApiGatewayV2::Integration",
    },
    "irmaissueapiGETloginirmaissueloginPermissionE03E3DCA": Object {
      "Properties": Object {
        "Action": "lambda:InvokeFunction",
        "FunctionName": Object {
          "Fn::GetAtt": Array [
            "irmaissueloginfunctionlambda85C88306",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": Object {
          "Fn::Join": Array [
            "",
            Array [
              "arn:",
              Object {
                "Ref": "AWS::Partition",
              },
              ":execute-api:",
              Object {
                "Ref": "AWS::Region",
              },
              ":",
              Object {
                "Ref": "AWS::AccountId",
              },
              ":",
              Object {
                "Ref": "irmaissueapiD1979B65",
              },
              "/*/*/login",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "irmaissueapiGETlogout67709B5F": Object {
      "Properties": Object {
        "ApiId": Object {
          "Ref": "irmaissueapiD1979B65",
        },
        "AuthorizationType": "NONE",
        "RouteKey": "GET /logout",
        "Target": Object {
          "Fn::Join": Array [
            "",
            Array [
              "integrations/",
              Object {
                "Ref": "irmaissueapiGETlogoutirmaissuelogout88F657D9",
              },
            ],
          ],
        },
      },
      "Type": "AWS::ApiGatewayV2::Route",
    },
    "irmaissueapiGETlogoutirmaissuelogout88F657D9": Object {
      "Properties": Object {
        "ApiId": Object {
          "Ref": "irmaissueapiD1979B65",
        },
        "IntegrationType": "AWS_PROXY",
        "IntegrationUri": Object {
          "Fn::GetAtt": Array [
            "irmaissuelogoutfunctionlambda63E96064",
            "Arn",
          ],
        },
        "PayloadFormatVersion": "2.0",
      },
      "Type": "AWS::ApiGatewayV2::Integration",
    },
    "irmaissueapiGETlogoutirmaissuelogoutPermission8F9DB9FD": Object {
      "Properties": Object {
        "Action": "lambda:InvokeFunction",
        "FunctionName": Object {
          "Fn::GetAtt": Array [
            "irmaissuelogoutfunctionlambda63E96064",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": Object {
          "Fn::Join": Array [
            "",
            Array [
              "arn:",
              Object {
                "Ref": "AWS::Partition",
              },
              ":execute-api:",
              Object {
                "Ref": "AWS::Region",
              },
              ":",
              Object {
                "Ref": "AWS::AccountId",
              },
              ":",
              Object {
                "Ref": "irmaissueapiD1979B65",
              },
              "/*/*/logout",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "irmaissueauthfunctionMetricFilter39397E66": Object {
      "DeletionPolicy": "Delete",
      "Properties": Object {
        "FilterPattern": "\\"ERROR\\"",
        "LogGroupName": Object {
          "Fn::GetAtt": Array [
            "irmaissueauthfunctionlambdaLogRetention43C52D05",
            "LogGroupName",
          ],
        },
        "MetricTransformations": Array [
          Object {
            "MetricName": "Errors",
            "MetricNamespace": "irma-issue-app/irma-issue-auth-function",
            "MetricValue": "1",
          },
        ],
      },
      "Type": "AWS::Logs::MetricFilter",
      "UpdateReplacePolicy": "Delete",
    },
    "irmaissueauthfunctionirmaissueappirmaissueauthfunctionalarm8CA3BE31": Object {
      "DeletionPolicy": "Delete",
      "Properties": Object {
        "AlarmDescription": "This alarm triggers if the function irma-issue-auth-function is logging more than 5 errors over n minutes.",
        "AlarmName": "Increased error rate for irma-issue-auth-function",
        "ComparisonOperator": "GreaterThanOrEqualToThreshold",
        "EvaluationPeriods": 3,
        "MetricName": "Errors",
        "Namespace": "irma-issue-app/irma-issue-auth-function",
        "Period": 300,
        "Statistic": "Sum",
        "Threshold": 5,
      },
      "Type": "AWS::CloudWatch::Alarm",
      "UpdateReplacePolicy": "Delete",
    },
    "irmaissueauthfunctionlambda18551BF1": Object {
      "DependsOn": Array [
        "irmaissueauthfunctionlambdaServiceRoleDefaultPolicyCF9EDD2C",
        "irmaissueauthfunctionlambdaServiceRole550B08AB",
      ],
      "Properties": Object {
        "Code": Object {
          "S3Bucket": Object {
            "Fn::Sub": "cdk-hnb659fds-assets-\${AWS::AccountId}-\${AWS::Region}",
          },
          "S3Key": "41c9cca0546e1a301995a2de090e26279c2577cf00d25bdbc4372d634d6ed3bc.zip",
        },
        "Description": "Authenticatie-lambd voor de IRMA issue-applicatie.",
        "Environment": Object {
          "Variables": Object {
            "APPLICATION_URL_BASE": "https://snapshot-tests.nijmegen.nl/",
            "AUTH_URL_BASE": Object {
              "Ref": "SsmParameterValuecdkirmaissueappauthUrlBaseC96584B6F00A464EAD1953AFF4B05118Parameter",
            },
            "AWS_NODEJS_CONNECTION_REUSE_ENABLED": "1",
            "CLIENT_SECRET_ARN": Object {
              "Fn::Join": Array [
                "",
                Array [
                  "arn:",
                  Object {
                    "Ref": "AWS::Partition",
                  },
                  ":secretsmanager:",
                  Object {
                    "Ref": "AWS::Region",
                  },
                  ":",
                  Object {
                    "Ref": "AWS::AccountId",
                  },
                  ":secret:/cdk/irma-issue-app/oidc-clientsecret",
                ],
              ],
            },
            "OIDC_CLIENT_ID": Object {
              "Ref": "SsmParameterValuecdkirmaissueappauthClientIDC96584B6F00A464EAD1953AFF4B05118Parameter",
            },
            "OIDC_SCOPE": Object {
              "Ref": "SsmParameterValuecdkirmaissueappauthScopeC96584B6F00A464EAD1953AFF4B05118Parameter",
            },
            "SESSION_TABLE": Object {
              "Fn::ImportValue": "api-stage-snapshot-sessions-stack:ExportsOutputRefsessionstable9FEB29154441788E",
            },
          },
        },
        "Handler": "index.handler",
        "Layers": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:aws:lambda:",
                Object {
                  "Ref": "AWS::Region",
                },
                ":580247275435:layer:LambdaInsightsExtension:16",
              ],
            ],
          },
        ],
        "MemorySize": 512,
        "Role": Object {
          "Fn::GetAtt": Array [
            "irmaissueauthfunctionlambdaServiceRole550B08AB",
            "Arn",
          ],
        },
        "Runtime": "nodejs14.x",
      },
      "Type": "AWS::Lambda::Function",
    },
    "irmaissueauthfunctionlambdaLogRetention43C52D05": Object {
      "Properties": Object {
        "LogGroupName": Object {
          "Fn::Join": Array [
            "",
            Array [
              "/aws/lambda/",
              Object {
                "Ref": "irmaissueauthfunctionlambda18551BF1",
              },
            ],
          ],
        },
        "RetentionInDays": 30,
        "ServiceToken": Object {
          "Fn::GetAtt": Array [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "irmaissueauthfunctionlambdaServiceRole550B08AB": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/CloudWatchLambdaInsightsExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "irmaissueauthfunctionlambdaServiceRoleDefaultPolicyCF9EDD2C": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": Array [
                "kms:Decrypt",
                "kms:DescribeKey",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::ImportValue": "api-stage-snapshot-key-stack:ExportsOutputFnGetAttkmskey6257DE3DArnF7CD15EC",
              },
            },
            Object {
              "Action": Array [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": Array [
                Object {
                  "Fn::ImportValue": "api-stage-snapshot-sessions-stack:ExportsOutputFnGetAttsessionstable9FEB2915Arn94F05FDE",
                },
                Object {
                  "Ref": "AWS::NoValue",
                },
              ],
            },
            Object {
              "Action": Array [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::Join": Array [
                  "",
                  Array [
                    "arn:",
                    Object {
                      "Ref": "AWS::Partition",
                    },
                    ":secretsmanager:",
                    Object {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    Object {
                      "Ref": "AWS::AccountId",
                    },
                    ":secret:/cdk/irma-issue-app/oidc-clientsecret-??????",
                  ],
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "irmaissueauthfunctionlambdaServiceRoleDefaultPolicyCF9EDD2C",
        "Roles": Array [
          Object {
            "Ref": "irmaissueauthfunctionlambdaServiceRole550B08AB",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "irmaissueauthfunctionreadpolicyD20B11B5": Object {
      "Properties": Object {
        "Description": "",
        "Path": "/",
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": Array [
                "lambda:List*",
                "lambda:GetAccountSettings",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            Object {
              "Action": "lambda:Get*",
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissueauthfunctionlambda18551BF1",
                  "Arn",
                ],
              },
            },
            Object {
              "Action": Array [
                "logs:Describe*",
                "logs:Get*",
                "logs:List*",
                "logs:StartQuery",
                "logs:StopQuery",
                "logs:TestMetricFilter",
                "logs:FilterLogEvents",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::Join": Array [
                  "",
                  Array [
                    "arn:",
                    Object {
                      "Ref": "AWS::Partition",
                    },
                    ":logs:",
                    Object {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    Object {
                      "Ref": "AWS::AccountId",
                    },
                    ":log-group:",
                    Object {
                      "Fn::GetAtt": Array [
                        "irmaissueauthfunctionlambdaLogRetention43C52D05",
                        "LogGroupName",
                      ],
                    },
                    ":*",
                  ],
                ],
              },
            },
            Object {
              "Action": Array [
                "logs:Describe*",
                "logs:List*",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::ManagedPolicy",
    },
    "irmaissuecallbackfunctionMetricFilter6AB6FC8F": Object {
      "DeletionPolicy": "Delete",
      "Properties": Object {
        "FilterPattern": "\\"ERROR\\"",
        "LogGroupName": Object {
          "Fn::GetAtt": Array [
            "irmaissuecallbackfunctionlambdaLogRetentionFC489270",
            "LogGroupName",
          ],
        },
        "MetricTransformations": Array [
          Object {
            "MetricName": "Errors",
            "MetricNamespace": "irma-issue-app/irma-issue-callback-function",
            "MetricValue": "1",
          },
        ],
      },
      "Type": "AWS::Logs::MetricFilter",
      "UpdateReplacePolicy": "Delete",
    },
    "irmaissuecallbackfunctionirmaissueappirmaissuecallbackfunctionalarm19D0A12D": Object {
      "DeletionPolicy": "Delete",
      "Properties": Object {
        "AlarmDescription": "This alarm triggers if the function irma-issue-callback-function is logging more than 5 errors over n minutes.",
        "AlarmName": "Increased error rate for irma-issue-callback-function",
        "ComparisonOperator": "GreaterThanOrEqualToThreshold",
        "EvaluationPeriods": 3,
        "MetricName": "Errors",
        "Namespace": "irma-issue-app/irma-issue-callback-function",
        "Period": 300,
        "Statistic": "Sum",
        "Threshold": 5,
      },
      "Type": "AWS::CloudWatch::Alarm",
      "UpdateReplacePolicy": "Delete",
    },
    "irmaissuecallbackfunctionlambdaCDBC2637": Object {
      "DependsOn": Array [
        "irmaissuecallbackfunctionlambdaServiceRoleDefaultPolicyCB401089",
        "irmaissuecallbackfunctionlambdaServiceRole828D5C0F",
      ],
      "Properties": Object {
        "Code": Object {
          "S3Bucket": Object {
            "Fn::Sub": "cdk-hnb659fds-assets-\${AWS::AccountId}-\${AWS::Region}",
          },
          "S3Key": "fa7fa4e7df764856ab205ccd2de19e133aa80576c89fd3a194a851c342f5e67c.zip",
        },
        "Description": "Callback-lambda voor de IRMA issue-applicatie.",
        "Environment": Object {
          "Variables": Object {
            "APPLICATION_URL_BASE": "https://snapshot-tests.nijmegen.nl/",
            "AUTH_URL_BASE": Object {
              "Ref": "SsmParameterValuecdkirmaissueappauthUrlBaseC96584B6F00A464EAD1953AFF4B05118Parameter",
            },
            "AWS_NODEJS_CONNECTION_REUSE_ENABLED": "1",
            "DIVERSIFYER": Object {
              "Ref": "SsmParameterValuecdkirmaissueappsubjectdiversifierC96584B6F00A464EAD1953AFF4B05118Parameter",
            },
            "OIDC_CLIENT_ID": Object {
              "Ref": "SsmParameterValuecdkirmaissueappauthClientIDC96584B6F00A464EAD1953AFF4B05118Parameter",
            },
            "OIDC_SCOPE": Object {
              "Ref": "SsmParameterValuecdkirmaissueappauthScopeC96584B6F00A464EAD1953AFF4B05118Parameter",
            },
            "SESSION_TABLE": Object {
              "Fn::ImportValue": "api-stage-snapshot-sessions-stack:ExportsOutputRefsessionstable9FEB29154441788E",
            },
          },
        },
        "Handler": "index.handler",
        "Layers": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:aws:lambda:",
                Object {
                  "Ref": "AWS::Region",
                },
                ":580247275435:layer:LambdaInsightsExtension:16",
              ],
            ],
          },
        ],
        "MemorySize": 512,
        "Role": Object {
          "Fn::GetAtt": Array [
            "irmaissuecallbackfunctionlambdaServiceRole828D5C0F",
            "Arn",
          ],
        },
        "Runtime": "nodejs14.x",
      },
      "Type": "AWS::Lambda::Function",
    },
    "irmaissuecallbackfunctionlambdaLogRetentionFC489270": Object {
      "Properties": Object {
        "LogGroupName": Object {
          "Fn::Join": Array [
            "",
            Array [
              "/aws/lambda/",
              Object {
                "Ref": "irmaissuecallbackfunctionlambdaCDBC2637",
              },
            ],
          ],
        },
        "RetentionInDays": 365,
        "ServiceToken": Object {
          "Fn::GetAtt": Array [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "irmaissuecallbackfunctionlambdaServiceRole828D5C0F": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/CloudWatchLambdaInsightsExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "irmaissuecallbackfunctionlambdaServiceRoleDefaultPolicyCB401089": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": Array [
                "kms:Decrypt",
                "kms:DescribeKey",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::ImportValue": "api-stage-snapshot-key-stack:ExportsOutputFnGetAttkmskey6257DE3DArnF7CD15EC",
              },
            },
            Object {
              "Action": Array [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": Array [
                Object {
                  "Fn::ImportValue": "api-stage-snapshot-sessions-stack:ExportsOutputFnGetAttsessionstable9FEB2915Arn94F05FDE",
                },
                Object {
                  "Ref": "AWS::NoValue",
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "irmaissuecallbackfunctionlambdaServiceRoleDefaultPolicyCB401089",
        "Roles": Array [
          Object {
            "Ref": "irmaissuecallbackfunctionlambdaServiceRole828D5C0F",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "irmaissuecallbackfunctionloggroupssm8A8B3931": Object {
      "Properties": Object {
        "Name": "/cdk/irma-issue-app/statistics/log-group-name",
        "Type": "String",
        "Value": Object {
          "Fn::GetAtt": Array [
            "irmaissuecallbackfunctionlambdaLogRetentionFC489270",
            "LogGroupName",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "irmaissuecallbackfunctionreadpolicy106B450E": Object {
      "Properties": Object {
        "Description": "",
        "Path": "/",
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": Array [
                "lambda:List*",
                "lambda:GetAccountSettings",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            Object {
              "Action": "lambda:Get*",
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissuecallbackfunctionlambdaCDBC2637",
                  "Arn",
                ],
              },
            },
            Object {
              "Action": Array [
                "logs:Describe*",
                "logs:Get*",
                "logs:List*",
                "logs:StartQuery",
                "logs:StopQuery",
                "logs:TestMetricFilter",
                "logs:FilterLogEvents",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::Join": Array [
                  "",
                  Array [
                    "arn:",
                    Object {
                      "Ref": "AWS::Partition",
                    },
                    ":logs:",
                    Object {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    Object {
                      "Ref": "AWS::AccountId",
                    },
                    ":log-group:",
                    Object {
                      "Fn::GetAtt": Array [
                        "irmaissuecallbackfunctionlambdaLogRetentionFC489270",
                        "LogGroupName",
                      ],
                    },
                    ":*",
                  ],
                ],
              },
            },
            Object {
              "Action": Array [
                "logs:Describe*",
                "logs:List*",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::ManagedPolicy",
    },
    "irmaissueissuefunctionMetricFilter869A56D9": Object {
      "DeletionPolicy": "Delete",
      "Properties": Object {
        "FilterPattern": "\\"ERROR\\"",
        "LogGroupName": Object {
          "Fn::GetAtt": Array [
            "irmaissueissuefunctionlambdaLogRetentionF10819AB",
            "LogGroupName",
          ],
        },
        "MetricTransformations": Array [
          Object {
            "MetricName": "Errors",
            "MetricNamespace": "irma-issue-app/irma-issue-issue-function",
            "MetricValue": "1",
          },
        ],
      },
      "Type": "AWS::Logs::MetricFilter",
      "UpdateReplacePolicy": "Delete",
    },
    "irmaissueissuefunctionirmaissueappirmaissueissuefunctionalarmA2A689DD": Object {
      "DeletionPolicy": "Delete",
      "Properties": Object {
        "AlarmDescription": "This alarm triggers if the function irma-issue-issue-function is logging more than 5 errors over n minutes.",
        "AlarmName": "Increased error rate for irma-issue-issue-function",
        "ComparisonOperator": "GreaterThanOrEqualToThreshold",
        "EvaluationPeriods": 3,
        "MetricName": "Errors",
        "Namespace": "irma-issue-app/irma-issue-issue-function",
        "Period": 300,
        "Statistic": "Sum",
        "Threshold": 5,
      },
      "Type": "AWS::CloudWatch::Alarm",
      "UpdateReplacePolicy": "Delete",
    },
    "irmaissueissuefunctionlambda8FDA038F": Object {
      "DependsOn": Array [
        "irmaissueissuefunctionlambdaServiceRoleDefaultPolicy1D2D09F0",
        "irmaissueissuefunctionlambdaServiceRole96B470D9",
      ],
      "Properties": Object {
        "Code": Object {
          "S3Bucket": Object {
            "Fn::Sub": "cdk-hnb659fds-assets-\${AWS::AccountId}-\${AWS::Region}",
          },
          "S3Key": "92a3964a1f73da3726bd89af34333021ed8f59a3055e27258350064ae0ddf7fb.zip",
        },
        "Description": "Home-lambda voor de IRMA issue-applicatie.",
        "Environment": Object {
          "Variables": Object {
            "APPLICATION_URL_BASE": "https://snapshot-tests.nijmegen.nl/",
            "AUTH_URL_BASE": Object {
              "Ref": "SsmParameterValuecdkirmaissueappauthUrlBaseC96584B6F00A464EAD1953AFF4B05118Parameter",
            },
            "AWS_NODEJS_CONNECTION_REUSE_ENABLED": "1",
            "BRP_API_URL": Object {
              "Ref": "SsmParameterValuecdkirmaissueappbrpapiurlC96584B6F00A464EAD1953AFF4B05118Parameter",
            },
            "IRMA_API_ACCESS_KEY_ID_ARN": Object {
              "Fn::Join": Array [
                "",
                Array [
                  "arn:",
                  Object {
                    "Ref": "AWS::Partition",
                  },
                  ":secretsmanager:",
                  Object {
                    "Ref": "AWS::Region",
                  },
                  ":",
                  Object {
                    "Ref": "AWS::AccountId",
                  },
                  ":secret:/cdk/irma-issue-app/irma-api-access-key-id",
                ],
              ],
            },
            "IRMA_API_DEMO": Object {
              "Ref": "SsmParameterValuecdkirmaissueappirmaapidemoC96584B6F00A464EAD1953AFF4B05118Parameter",
            },
            "IRMA_API_HOST": Object {
              "Ref": "SsmParameterValuecdkirmaissueappirmaapihostC96584B6F00A464EAD1953AFF4B05118Parameter",
            },
            "IRMA_API_KEY_ARN": Object {
              "Fn::Join": Array [
                "",
                Array [
                  "arn:",
                  Object {
                    "Ref": "AWS::Partition",
                  },
                  ":secretsmanager:",
                  Object {
                    "Ref": "AWS::Region",
                  },
                  ":",
                  Object {
                    "Ref": "AWS::AccountId",
                  },
                  ":secret:/cdk/irma-issue-app/irma-api-key",
                ],
              ],
            },
            "IRMA_API_SECRET_KEY_ARN": Object {
              "Fn::Join": Array [
                "",
                Array [
                  "arn:",
                  Object {
                    "Ref": "AWS::Partition",
                  },
                  ":secretsmanager:",
                  Object {
                    "Ref": "AWS::Region",
                  },
                  ":",
                  Object {
                    "Ref": "AWS::AccountId",
                  },
                  ":secret:/cdk/irma-issue-app/irma-api-secret-key",
                ],
              ],
            },
            "MTLS_CLIENT_CERT_NAME": "/cdk/irma-issue-app/mtls-clientcert",
            "MTLS_PRIVATE_KEY_ARN": Object {
              "Fn::Join": Array [
                "",
                Array [
                  "arn:",
                  Object {
                    "Ref": "AWS::Partition",
                  },
                  ":secretsmanager:",
                  Object {
                    "Ref": "AWS::Region",
                  },
                  ":",
                  Object {
                    "Ref": "AWS::AccountId",
                  },
                  ":secret:/cdk/irma-issue-app/mtls-privatekey",
                ],
              ],
            },
            "MTLS_ROOT_CA_NAME": "/cdk/irma-issue-app/mtls-rootca",
            "OIDC_CLIENT_ID": Object {
              "Ref": "SsmParameterValuecdkirmaissueappauthClientIDC96584B6F00A464EAD1953AFF4B05118Parameter",
            },
            "OIDC_SCOPE": Object {
              "Ref": "SsmParameterValuecdkirmaissueappauthScopeC96584B6F00A464EAD1953AFF4B05118Parameter",
            },
            "SESSION_TABLE": Object {
              "Fn::ImportValue": "api-stage-snapshot-sessions-stack:ExportsOutputRefsessionstable9FEB29154441788E",
            },
          },
        },
        "Handler": "index.handler",
        "Layers": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:aws:lambda:",
                Object {
                  "Ref": "AWS::Region",
                },
                ":580247275435:layer:LambdaInsightsExtension:16",
              ],
            ],
          },
        ],
        "MemorySize": 512,
        "Role": Object {
          "Fn::GetAtt": Array [
            "irmaissueissuefunctionlambdaServiceRole96B470D9",
            "Arn",
          ],
        },
        "Runtime": "nodejs14.x",
      },
      "Type": "AWS::Lambda::Function",
    },
    "irmaissueissuefunctionlambdaLogRetentionF10819AB": Object {
      "Properties": Object {
        "LogGroupName": Object {
          "Fn::Join": Array [
            "",
            Array [
              "/aws/lambda/",
              Object {
                "Ref": "irmaissueissuefunctionlambda8FDA038F",
              },
            ],
          ],
        },
        "RetentionInDays": 30,
        "ServiceToken": Object {
          "Fn::GetAtt": Array [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "irmaissueissuefunctionlambdaServiceRole96B470D9": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/CloudWatchLambdaInsightsExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "irmaissueissuefunctionlambdaServiceRoleDefaultPolicy1D2D09F0": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": Array [
                "kms:Decrypt",
                "kms:DescribeKey",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::ImportValue": "api-stage-snapshot-key-stack:ExportsOutputFnGetAttkmskey6257DE3DArnF7CD15EC",
              },
            },
            Object {
              "Action": Array [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": Array [
                Object {
                  "Fn::ImportValue": "api-stage-snapshot-sessions-stack:ExportsOutputFnGetAttsessionstable9FEB2915Arn94F05FDE",
                },
                Object {
                  "Ref": "AWS::NoValue",
                },
              ],
            },
            Object {
              "Action": Array [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::Join": Array [
                  "",
                  Array [
                    "arn:",
                    Object {
                      "Ref": "AWS::Partition",
                    },
                    ":secretsmanager:",
                    Object {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    Object {
                      "Ref": "AWS::AccountId",
                    },
                    ":secret:/cdk/irma-issue-app/mtls-privatekey-??????",
                  ],
                ],
              },
            },
            Object {
              "Action": Array [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::Join": Array [
                  "",
                  Array [
                    "arn:",
                    Object {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:",
                    Object {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    Object {
                      "Ref": "AWS::AccountId",
                    },
                    ":parameter/cdk/irma-issue-app/mtls-clientcert",
                  ],
                ],
              },
            },
            Object {
              "Action": Array [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::Join": Array [
                  "",
                  Array [
                    "arn:",
                    Object {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:",
                    Object {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    Object {
                      "Ref": "AWS::AccountId",
                    },
                    ":parameter/cdk/irma-issue-app/mtls-rootca",
                  ],
                ],
              },
            },
            Object {
              "Action": Array [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::Join": Array [
                  "",
                  Array [
                    "arn:",
                    Object {
                      "Ref": "AWS::Partition",
                    },
                    ":secretsmanager:",
                    Object {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    Object {
                      "Ref": "AWS::AccountId",
                    },
                    ":secret:/cdk/irma-issue-app/irma-api-access-key-id-??????",
                  ],
                ],
              },
            },
            Object {
              "Action": Array [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::Join": Array [
                  "",
                  Array [
                    "arn:",
                    Object {
                      "Ref": "AWS::Partition",
                    },
                    ":secretsmanager:",
                    Object {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    Object {
                      "Ref": "AWS::AccountId",
                    },
                    ":secret:/cdk/irma-issue-app/irma-api-secret-key-??????",
                  ],
                ],
              },
            },
            Object {
              "Action": Array [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::Join": Array [
                  "",
                  Array [
                    "arn:",
                    Object {
                      "Ref": "AWS::Partition",
                    },
                    ":secretsmanager:",
                    Object {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    Object {
                      "Ref": "AWS::AccountId",
                    },
                    ":secret:/cdk/irma-issue-app/irma-api-key-??????",
                  ],
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "irmaissueissuefunctionlambdaServiceRoleDefaultPolicy1D2D09F0",
        "Roles": Array [
          Object {
            "Ref": "irmaissueissuefunctionlambdaServiceRole96B470D9",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "irmaissueissuefunctionreadpolicy42EBC638": Object {
      "Properties": Object {
        "Description": "",
        "Path": "/",
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": Array [
                "lambda:List*",
                "lambda:GetAccountSettings",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            Object {
              "Action": "lambda:Get*",
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissueissuefunctionlambda8FDA038F",
                  "Arn",
                ],
              },
            },
            Object {
              "Action": Array [
                "logs:Describe*",
                "logs:Get*",
                "logs:List*",
                "logs:StartQuery",
                "logs:StopQuery",
                "logs:TestMetricFilter",
                "logs:FilterLogEvents",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::Join": Array [
                  "",
                  Array [
                    "arn:",
                    Object {
                      "Ref": "AWS::Partition",
                    },
                    ":logs:",
                    Object {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    Object {
                      "Ref": "AWS::AccountId",
                    },
                    ":log-group:",
                    Object {
                      "Fn::GetAtt": Array [
                        "irmaissueissuefunctionlambdaLogRetentionF10819AB",
                        "LogGroupName",
                      ],
                    },
                    ":*",
                  ],
                ],
              },
            },
            Object {
              "Action": Array [
                "logs:Describe*",
                "logs:List*",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::ManagedPolicy",
    },
    "irmaissueloginfunctionMetricFilterDFEDFC1A": Object {
      "DeletionPolicy": "Delete",
      "Properties": Object {
        "FilterPattern": "\\"ERROR\\"",
        "LogGroupName": Object {
          "Fn::GetAtt": Array [
            "irmaissueloginfunctionlambdaLogRetention0805C042",
            "LogGroupName",
          ],
        },
        "MetricTransformations": Array [
          Object {
            "MetricName": "Errors",
            "MetricNamespace": "irma-issue-app/irma-issue-login-function",
            "MetricValue": "1",
          },
        ],
      },
      "Type": "AWS::Logs::MetricFilter",
      "UpdateReplacePolicy": "Delete",
    },
    "irmaissueloginfunctionirmaissueappirmaissueloginfunctionalarmBAA4698A": Object {
      "DeletionPolicy": "Delete",
      "Properties": Object {
        "AlarmDescription": "This alarm triggers if the function irma-issue-login-function is logging more than 5 errors over n minutes.",
        "AlarmName": "Increased error rate for irma-issue-login-function",
        "ComparisonOperator": "GreaterThanOrEqualToThreshold",
        "EvaluationPeriods": 3,
        "MetricName": "Errors",
        "Namespace": "irma-issue-app/irma-issue-login-function",
        "Period": 300,
        "Statistic": "Sum",
        "Threshold": 5,
      },
      "Type": "AWS::CloudWatch::Alarm",
      "UpdateReplacePolicy": "Delete",
    },
    "irmaissueloginfunctionlambda85C88306": Object {
      "DependsOn": Array [
        "irmaissueloginfunctionlambdaServiceRoleDefaultPolicyD5006177",
        "irmaissueloginfunctionlambdaServiceRoleD16D9349",
      ],
      "Properties": Object {
        "Code": Object {
          "S3Bucket": Object {
            "Fn::Sub": "cdk-hnb659fds-assets-\${AWS::AccountId}-\${AWS::Region}",
          },
          "S3Key": "bd8181c8f51323814bd07c84b2b80b802f9d199b2e47fd027fc4f0f16b01b553.zip",
        },
        "Description": "Login-pagina voor de IRMA issue-applicatie.",
        "Environment": Object {
          "Variables": Object {
            "APPLICATION_URL_BASE": "https://snapshot-tests.nijmegen.nl/",
            "AUTH_URL_BASE": Object {
              "Ref": "SsmParameterValuecdkirmaissueappauthUrlBaseC96584B6F00A464EAD1953AFF4B05118Parameter",
            },
            "AWS_NODEJS_CONNECTION_REUSE_ENABLED": "1",
            "OIDC_CLIENT_ID": Object {
              "Ref": "SsmParameterValuecdkirmaissueappauthClientIDC96584B6F00A464EAD1953AFF4B05118Parameter",
            },
            "OIDC_SCOPE": Object {
              "Ref": "SsmParameterValuecdkirmaissueappauthScopeC96584B6F00A464EAD1953AFF4B05118Parameter",
            },
            "SESSION_TABLE": Object {
              "Fn::ImportValue": "api-stage-snapshot-sessions-stack:ExportsOutputRefsessionstable9FEB29154441788E",
            },
          },
        },
        "Handler": "index.handler",
        "Layers": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:aws:lambda:",
                Object {
                  "Ref": "AWS::Region",
                },
                ":580247275435:layer:LambdaInsightsExtension:16",
              ],
            ],
          },
        ],
        "MemorySize": 512,
        "Role": Object {
          "Fn::GetAtt": Array [
            "irmaissueloginfunctionlambdaServiceRoleD16D9349",
            "Arn",
          ],
        },
        "Runtime": "nodejs14.x",
      },
      "Type": "AWS::Lambda::Function",
    },
    "irmaissueloginfunctionlambdaLogRetention0805C042": Object {
      "Properties": Object {
        "LogGroupName": Object {
          "Fn::Join": Array [
            "",
            Array [
              "/aws/lambda/",
              Object {
                "Ref": "irmaissueloginfunctionlambda85C88306",
              },
            ],
          ],
        },
        "RetentionInDays": 30,
        "ServiceToken": Object {
          "Fn::GetAtt": Array [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "irmaissueloginfunctionlambdaServiceRoleD16D9349": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/CloudWatchLambdaInsightsExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "irmaissueloginfunctionlambdaServiceRoleDefaultPolicyD5006177": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": Array [
                "kms:Decrypt",
                "kms:DescribeKey",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::ImportValue": "api-stage-snapshot-key-stack:ExportsOutputFnGetAttkmskey6257DE3DArnF7CD15EC",
              },
            },
            Object {
              "Action": Array [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": Array [
                Object {
                  "Fn::ImportValue": "api-stage-snapshot-sessions-stack:ExportsOutputFnGetAttsessionstable9FEB2915Arn94F05FDE",
                },
                Object {
                  "Ref": "AWS::NoValue",
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "irmaissueloginfunctionlambdaServiceRoleDefaultPolicyD5006177",
        "Roles": Array [
          Object {
            "Ref": "irmaissueloginfunctionlambdaServiceRoleD16D9349",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "irmaissueloginfunctionreadpolicy6D9F0A60": Object {
      "Properties": Object {
        "Description": "",
        "Path": "/",
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": Array [
                "lambda:List*",
                "lambda:GetAccountSettings",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            Object {
              "Action": "lambda:Get*",
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissueloginfunctionlambda85C88306",
                  "Arn",
                ],
              },
            },
            Object {
              "Action": Array [
                "logs:Describe*",
                "logs:Get*",
                "logs:List*",
                "logs:StartQuery",
                "logs:StopQuery",
                "logs:TestMetricFilter",
                "logs:FilterLogEvents",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::Join": Array [
                  "",
                  Array [
                    "arn:",
                    Object {
                      "Ref": "AWS::Partition",
                    },
                    ":logs:",
                    Object {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    Object {
                      "Ref": "AWS::AccountId",
                    },
                    ":log-group:",
                    Object {
                      "Fn::GetAtt": Array [
                        "irmaissueloginfunctionlambdaLogRetention0805C042",
                        "LogGroupName",
                      ],
                    },
                    ":*",
                  ],
                ],
              },
            },
            Object {
              "Action": Array [
                "logs:Describe*",
                "logs:List*",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::ManagedPolicy",
    },
    "irmaissuelogoutfunctionMetricFilter2E5C40C4": Object {
      "DeletionPolicy": "Delete",
      "Properties": Object {
        "FilterPattern": "\\"ERROR\\"",
        "LogGroupName": Object {
          "Fn::GetAtt": Array [
            "irmaissuelogoutfunctionlambdaLogRetentionCF725A8C",
            "LogGroupName",
          ],
        },
        "MetricTransformations": Array [
          Object {
            "MetricName": "Errors",
            "MetricNamespace": "irma-issue-app/irma-issue-logout-function",
            "MetricValue": "1",
          },
        ],
      },
      "Type": "AWS::Logs::MetricFilter",
      "UpdateReplacePolicy": "Delete",
    },
    "irmaissuelogoutfunctionirmaissueappirmaissuelogoutfunctionalarm38751751": Object {
      "DeletionPolicy": "Delete",
      "Properties": Object {
        "AlarmDescription": "This alarm triggers if the function irma-issue-logout-function is logging more than 5 errors over n minutes.",
        "AlarmName": "Increased error rate for irma-issue-logout-function",
        "ComparisonOperator": "GreaterThanOrEqualToThreshold",
        "EvaluationPeriods": 3,
        "MetricName": "Errors",
        "Namespace": "irma-issue-app/irma-issue-logout-function",
        "Period": 300,
        "Statistic": "Sum",
        "Threshold": 5,
      },
      "Type": "AWS::CloudWatch::Alarm",
      "UpdateReplacePolicy": "Delete",
    },
    "irmaissuelogoutfunctionlambda63E96064": Object {
      "DependsOn": Array [
        "irmaissuelogoutfunctionlambdaServiceRoleDefaultPolicyF7A0AF97",
        "irmaissuelogoutfunctionlambdaServiceRole1DBF152B",
      ],
      "Properties": Object {
        "Code": Object {
          "S3Bucket": Object {
            "Fn::Sub": "cdk-hnb659fds-assets-\${AWS::AccountId}-\${AWS::Region}",
          },
          "S3Key": "25b801d36f937be1d91523cd9fa6cfb0fb5d47f413d086d044910909d3861c24.zip",
        },
        "Description": "Uitlog-pagina voor de IRMA issue-applicatie.",
        "Environment": Object {
          "Variables": Object {
            "APPLICATION_URL_BASE": "https://snapshot-tests.nijmegen.nl/",
            "AUTH_URL_BASE": Object {
              "Ref": "SsmParameterValuecdkirmaissueappauthUrlBaseC96584B6F00A464EAD1953AFF4B05118Parameter",
            },
            "AWS_NODEJS_CONNECTION_REUSE_ENABLED": "1",
            "OIDC_CLIENT_ID": Object {
              "Ref": "SsmParameterValuecdkirmaissueappauthClientIDC96584B6F00A464EAD1953AFF4B05118Parameter",
            },
            "OIDC_SCOPE": Object {
              "Ref": "SsmParameterValuecdkirmaissueappauthScopeC96584B6F00A464EAD1953AFF4B05118Parameter",
            },
            "SESSION_TABLE": Object {
              "Fn::ImportValue": "api-stage-snapshot-sessions-stack:ExportsOutputRefsessionstable9FEB29154441788E",
            },
          },
        },
        "Handler": "index.handler",
        "Layers": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:aws:lambda:",
                Object {
                  "Ref": "AWS::Region",
                },
                ":580247275435:layer:LambdaInsightsExtension:16",
              ],
            ],
          },
        ],
        "MemorySize": 512,
        "Role": Object {
          "Fn::GetAtt": Array [
            "irmaissuelogoutfunctionlambdaServiceRole1DBF152B",
            "Arn",
          ],
        },
        "Runtime": "nodejs14.x",
      },
      "Type": "AWS::Lambda::Function",
    },
    "irmaissuelogoutfunctionlambdaLogRetentionCF725A8C": Object {
      "Properties": Object {
        "LogGroupName": Object {
          "Fn::Join": Array [
            "",
            Array [
              "/aws/lambda/",
              Object {
                "Ref": "irmaissuelogoutfunctionlambda63E96064",
              },
            ],
          ],
        },
        "RetentionInDays": 30,
        "ServiceToken": Object {
          "Fn::GetAtt": Array [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "irmaissuelogoutfunctionlambdaServiceRole1DBF152B": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/CloudWatchLambdaInsightsExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "irmaissuelogoutfunctionlambdaServiceRoleDefaultPolicyF7A0AF97": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": Array [
                "kms:Decrypt",
                "kms:DescribeKey",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::ImportValue": "api-stage-snapshot-key-stack:ExportsOutputFnGetAttkmskey6257DE3DArnF7CD15EC",
              },
            },
            Object {
              "Action": Array [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": Array [
                Object {
                  "Fn::ImportValue": "api-stage-snapshot-sessions-stack:ExportsOutputFnGetAttsessionstable9FEB2915Arn94F05FDE",
                },
                Object {
                  "Ref": "AWS::NoValue",
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "irmaissuelogoutfunctionlambdaServiceRoleDefaultPolicyF7A0AF97",
        "Roles": Array [
          Object {
            "Ref": "irmaissuelogoutfunctionlambdaServiceRole1DBF152B",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "irmaissuelogoutfunctionreadpolicy5FB04E2B": Object {
      "Properties": Object {
        "Description": "",
        "Path": "/",
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": Array [
                "lambda:List*",
                "lambda:GetAccountSettings",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            Object {
              "Action": "lambda:Get*",
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissuelogoutfunctionlambda63E96064",
                  "Arn",
                ],
              },
            },
            Object {
              "Action": Array [
                "logs:Describe*",
                "logs:Get*",
                "logs:List*",
                "logs:StartQuery",
                "logs:StopQuery",
                "logs:TestMetricFilter",
                "logs:FilterLogEvents",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::Join": Array [
                  "",
                  Array [
                    "arn:",
                    Object {
                      "Ref": "AWS::Partition",
                    },
                    ":logs:",
                    Object {
                      "Ref": "AWS::Region",
                    },
                    ":",
                    Object {
                      "Ref": "AWS::AccountId",
                    },
                    ":log-group:",
                    Object {
                      "Fn::GetAtt": Array [
                        "irmaissuelogoutfunctionlambdaLogRetentionCF725A8C",
                        "LogGroupName",
                      ],
                    },
                    ":*",
                  ],
                ],
              },
            },
            Object {
              "Action": Array [
                "logs:Describe*",
                "logs:List*",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::ManagedPolicy",
    },
    "readonlyrole4C10139C": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Condition": Object {
                "Bool": Object {
                  "aws:MultiFactorAuthPresent": true,
                },
              },
              "Effect": "Allow",
              "Principal": Object {
                "AWS": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::098799052470:root",
                    ],
                  ],
                },
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Description": "Read-only role for IRMA issue app with access to lambdas, logging, session store",
        "ManagedPolicyArns": Array [
          Object {
            "Ref": "irmaissueloginfunctionreadpolicy6D9F0A60",
          },
          Object {
            "Ref": "irmaissuelogoutfunctionreadpolicy5FB04E2B",
          },
          Object {
            "Ref": "irmaissueauthfunctionreadpolicyD20B11B5",
          },
          Object {
            "Ref": "irmaissueissuefunctionreadpolicy42EBC638",
          },
          Object {
            "Ref": "irmaissuecallbackfunctionreadpolicy106B450E",
          },
          Object {
            "Ref": "readpolicy4D8790E4",
          },
        ],
        "RoleName": "irma-issue-full-read",
      },
      "Type": "AWS::IAM::Role",
    },
    "readpolicy4D8790E4": Object {
      "Properties": Object {
        "Description": "",
        "Path": "/",
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": Array [
                "dynamodb:BatchGetItem",
                "dynamodb:Describe*",
                "dynamodb:List*",
                "dynamodb:GetItem",
                "dynamodb:Query",
                "dynamodb:Scan",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::ImportValue": "api-stage-snapshot-sessions-stack:ExportsOutputFnGetAttsessionstable9FEB2915Arn94F05FDE",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::ManagedPolicy",
    },
    "ssmapi1DB221E5E": Object {
      "Properties": Object {
        "Name": "/cdk/irma-issue-app/apigateway-id",
        "Type": "String",
        "Value": Object {
          "Ref": "irmaissueapiD1979B65",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ssmreadonly3F91D67D": Object {
      "Properties": Object {
        "Name": "/cdk/irma-issue-app/role-readonly-arn",
        "Type": "String",
        "Value": Object {
          "Fn::GetAtt": Array [
            "readonlyrole4C10139C",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
  },
  "Rules": Object {
    "CheckBootstrapVersion": Object {
      "Assertions": Array [
        Object {
          "Assert": Object {
            "Fn::Not": Array [
              Object {
                "Fn::Contains": Array [
                  Array [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  Object {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`ApiStage snapshot 7`] = `
Object {
  "Mappings": Object {
    "AWSCloudFrontPartitionHostedZoneIdMap": Object {
      "aws": Object {
        "zoneId": "Z2FDTNDATAQYW2",
      },
      "aws-cn": Object {
        "zoneId": "Z3RFFRIM2A3IF5",
      },
    },
  },
  "Parameters": Object {
    "BootstrapVersion": Object {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuecdkirmaissueappirmaapihostC96584B6F00A464EAD1953AFF4B05118Parameter": Object {
      "Default": "/cdk/irma-issue-app/irma-api-host",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuecdkirmaissueappzoneidC96584B6F00A464EAD1953AFF4B05118Parameter": Object {
      "Default": "/cdk/irma-issue-app/zone/id",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuecdkirmaissueappzonenameC96584B6F00A464EAD1953AFF4B05118Parameter": Object {
      "Default": "/cdk/irma-issue-app/zone/name",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": Object {
    "BucketNotificationsHandler050a0587b7544547bf325f094a3db8347ECC3691": Object {
      "DependsOn": Array [
        "BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleDefaultPolicy2CF63D36",
        "BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleB6FB88EC",
      ],
      "Properties": Object {
        "Code": Object {
          "ZipFile": "import boto3  # type: ignore
import json
import logging
import urllib.request

s3 = boto3.client(\\"s3\\")

EVENTBRIDGE_CONFIGURATION = 'EventBridgeConfiguration'

CONFIGURATION_TYPES = [\\"TopicConfigurations\\", \\"QueueConfigurations\\", \\"LambdaFunctionConfigurations\\"]

def handler(event: dict, context):
  response_status = \\"SUCCESS\\"
  error_message = \\"\\"
  try:
    props = event[\\"ResourceProperties\\"]
    bucket = props[\\"BucketName\\"]
    notification_configuration = props[\\"NotificationConfiguration\\"]
    request_type = event[\\"RequestType\\"]
    managed = props.get('Managed', 'true').lower() == 'true'
    stack_id = event['StackId']

    if managed:
      config = handle_managed(request_type, notification_configuration)
    else:
      config = handle_unmanaged(bucket, stack_id, request_type, notification_configuration)

    put_bucket_notification_configuration(bucket, config)
  except Exception as e:
    logging.exception(\\"Failed to put bucket notification configuration\\")
    response_status = \\"FAILED\\"
    error_message = f\\"Error: {str(e)}. \\"
  finally:
    submit_response(event, context, response_status, error_message)

def handle_managed(request_type, notification_configuration):
  if request_type == 'Delete':
    return {}
  return notification_configuration

def handle_unmanaged(bucket, stack_id, request_type, notification_configuration):
  external_notifications = find_external_notifications(bucket, stack_id)

  if request_type == 'Delete':
    return external_notifications

  def with_id(notification):
    notification['Id'] = f\\"{stack_id}-{hash(json.dumps(notification, sort_keys=True))}\\"
    return notification

  notifications = {}
  for t in CONFIGURATION_TYPES:
    external = external_notifications.get(t, [])
    incoming = [with_id(n) for n in notification_configuration.get(t, [])]
    notifications[t] = external + incoming

  if EVENTBRIDGE_CONFIGURATION in notification_configuration:
    notifications[EVENTBRIDGE_CONFIGURATION] = notification_configuration[EVENTBRIDGE_CONFIGURATION]
  elif EVENTBRIDGE_CONFIGURATION in external_notifications:
    notifications[EVENTBRIDGE_CONFIGURATION] = external_notifications[EVENTBRIDGE_CONFIGURATION]

  return notifications

def find_external_notifications(bucket, stack_id):
  existing_notifications = get_bucket_notification_configuration(bucket)
  external_notifications = {}
  for t in CONFIGURATION_TYPES:
    external_notifications[t] = [n for n in existing_notifications.get(t, []) if not n['Id'].startswith(f\\"{stack_id}-\\")]

  if EVENTBRIDGE_CONFIGURATION in existing_notifications:
    external_notifications[EVENTBRIDGE_CONFIGURATION] = existing_notifications[EVENTBRIDGE_CONFIGURATION]

  return external_notifications

def get_bucket_notification_configuration(bucket):
  return s3.get_bucket_notification_configuration(Bucket=bucket)

def put_bucket_notification_configuration(bucket, notification_configuration):
  s3.put_bucket_notification_configuration(Bucket=bucket, NotificationConfiguration=notification_configuration)

def submit_response(event: dict, context, response_status: str, error_message: str):
  response_body = json.dumps(
    {
      \\"Status\\": response_status,
      \\"Reason\\": f\\"{error_message}See the details in CloudWatch Log Stream: {context.log_stream_name}\\",
      \\"PhysicalResourceId\\": event.get(\\"PhysicalResourceId\\") or event[\\"LogicalResourceId\\"],
      \\"StackId\\": event[\\"StackId\\"],
      \\"RequestId\\": event[\\"RequestId\\"],
      \\"LogicalResourceId\\": event[\\"LogicalResourceId\\"],
      \\"NoEcho\\": False,
    }
  ).encode(\\"utf-8\\")
  headers = {\\"content-type\\": \\"\\", \\"content-length\\": str(len(response_body))}
  try:
    req = urllib.request.Request(url=event[\\"ResponseURL\\"], headers=headers, data=response_body, method=\\"PUT\\")
    with urllib.request.urlopen(req) as response:
      print(response.read().decode(\\"utf-8\\"))
    print(\\"Status code: \\" + response.reason)
  except Exception as e:
      print(\\"send(..) failed executing request.urlopen(..): \\" + str(e))
",
        },
        "Description": "AWS CloudFormation handler for \\"Custom::S3BucketNotifications\\" resources (@aws-cdk/aws-s3)",
        "Handler": "index.handler",
        "Role": Object {
          "Fn::GetAtt": Array [
            "BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleB6FB88EC",
            "Arn",
          ],
        },
        "Runtime": "python3.9",
        "Timeout": 300,
      },
      "Type": "AWS::Lambda::Function",
    },
    "BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleB6FB88EC": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleDefaultPolicy2CF63D36": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "s3:PutBucketNotification",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleDefaultPolicy2CF63D36",
        "Roles": Array [
          Object {
            "Ref": "BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleB6FB88EC",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "CloudfrontLogs7FFCD299": Object {
      "DeletionPolicy": "Retain",
      "Properties": Object {
        "BucketEncryption": Object {
          "ServerSideEncryptionConfiguration": Array [
            Object {
              "ServerSideEncryptionByDefault": Object {
                "SSEAlgorithm": "AES256",
              },
            },
          ],
        },
        "LifecycleConfiguration": Object {
          "Rules": Array [
            Object {
              "ExpirationInDays": 180,
              "Id": "delete objects after 180 days",
              "Status": "Enabled",
            },
          ],
        },
        "PublicAccessBlockConfiguration": Object {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true,
        },
      },
      "Type": "AWS::S3::Bucket",
      "UpdateReplacePolicy": "Retain",
    },
    "CloudfrontLogsNotificationsD110D18C": Object {
      "Properties": Object {
        "BucketName": Object {
          "Ref": "CloudfrontLogs7FFCD299",
        },
        "Managed": true,
        "NotificationConfiguration": Object {
          "EventBridgeConfiguration": Object {},
        },
        "ServiceToken": Object {
          "Fn::GetAtt": Array [
            "BucketNotificationsHandler050a0587b7544547bf325f094a3db8347ECC3691",
            "Arn",
          ],
        },
      },
      "Type": "Custom::S3BucketNotifications",
    },
    "CloudfrontLogsPolicy4B38713A": Object {
      "Properties": Object {
        "Bucket": Object {
          "Ref": "CloudfrontLogs7FFCD299",
        },
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "s3:*",
              "Condition": Object {
                "Bool": Object {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": Object {
                "AWS": "*",
              },
              "Resource": Array [
                Object {
                  "Fn::GetAtt": Array [
                    "CloudfrontLogs7FFCD299",
                    "Arn",
                  ],
                },
                Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      Object {
                        "Fn::GetAtt": Array [
                          "CloudfrontLogs7FFCD299",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::S3::BucketPolicy",
    },
    "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C81C01536": Object {
      "DependsOn": Array [
        "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRoleDefaultPolicy88902FDF",
        "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265",
      ],
      "Properties": Object {
        "Code": Object {
          "S3Bucket": Object {
            "Fn::Sub": "cdk-hnb659fds-assets-\${AWS::AccountId}-\${AWS::Region}",
          },
          "S3Key": "2bc265c5e0569aeb24a6349c15bd54e76e845892376515e036627ab0cc70bb64.zip",
        },
        "Handler": "index.handler",
        "Layers": Array [
          Object {
            "Ref": "staticResourcesAwsCliLayer07A04ABC",
          },
        ],
        "Role": Object {
          "Fn::GetAtt": Array [
            "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265",
            "Arn",
          ],
        },
        "Runtime": "python3.9",
        "Timeout": 900,
      },
      "Type": "AWS::Lambda::Function",
    },
    "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRoleDefaultPolicy88902FDF": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": Array [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
              ],
              "Effect": "Allow",
              "Resource": Array [
                Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::",
                      Object {
                        "Fn::Sub": "cdk-hnb659fds-assets-\${AWS::AccountId}-\${AWS::Region}",
                      },
                    ],
                  ],
                },
                Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::",
                      Object {
                        "Fn::Sub": "cdk-hnb659fds-assets-\${AWS::AccountId}-\${AWS::Region}",
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            Object {
              "Action": Array [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": Array [
                Object {
                  "Fn::GetAtt": Array [
                    "resourcesbucket8DBB515A",
                    "Arn",
                  ],
                },
                Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      Object {
                        "Fn::GetAtt": Array [
                          "resourcesbucket8DBB515A",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            Object {
              "Action": Array [
                "cloudfront:GetInvalidation",
                "cloudfront:CreateInvalidation",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRoleDefaultPolicy88902FDF",
        "Roles": Array [
          Object {
            "Ref": "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A": Object {
      "DependsOn": Array [
        "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB",
        "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB",
      ],
      "Properties": Object {
        "Code": Object {
          "S3Bucket": Object {
            "Fn::Sub": "cdk-hnb659fds-assets-\${AWS::AccountId}-\${AWS::Region}",
          },
          "S3Key": "eb5b005c858404ea0c8f68098ed5dcdf5340e02461f149751d10f59c210d5ef8.zip",
        },
        "Handler": "index.handler",
        "Role": Object {
          "Fn::GetAtt": Array [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB",
            "Arn",
          ],
        },
        "Runtime": "nodejs14.x",
      },
      "Type": "AWS::Lambda::Function",
    },
    "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": Array [
                "logs:PutRetentionPolicy",
                "logs:DeleteRetentionPolicy",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB",
        "Roles": Array [
          Object {
            "Ref": "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "aaaarecord09CB0D1A": Object {
      "Properties": Object {
        "AliasTarget": Object {
          "DNSName": Object {
            "Fn::GetAtt": Array [
              "cfdistributionC7035EBF",
              "DomainName",
            ],
          },
          "HostedZoneId": Object {
            "Fn::FindInMap": Array [
              "AWSCloudFrontPartitionHostedZoneIdMap",
              Object {
                "Ref": "AWS::Partition",
              },
              "zoneId",
            ],
          },
        },
        "HostedZoneId": Object {
          "Ref": "SsmParameterValuecdkirmaissueappzoneidC96584B6F00A464EAD1953AFF4B05118Parameter",
        },
        "Name": Object {
          "Fn::Join": Array [
            "",
            Array [
              Object {
                "Ref": "SsmParameterValuecdkirmaissueappzonenameC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
              ".",
            ],
          ],
        },
        "Type": "AAAA",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "arecordFEB8F42A": Object {
      "Properties": Object {
        "AliasTarget": Object {
          "DNSName": Object {
            "Fn::GetAtt": Array [
              "cfdistributionC7035EBF",
              "DomainName",
            ],
          },
          "HostedZoneId": Object {
            "Fn::FindInMap": Array [
              "AWSCloudFrontPartitionHostedZoneIdMap",
              Object {
                "Ref": "AWS::Partition",
              },
              "zoneId",
            ],
          },
        },
        "HostedZoneId": Object {
          "Ref": "SsmParameterValuecdkirmaissueappzoneidC96584B6F00A464EAD1953AFF4B05118Parameter",
        },
        "Name": Object {
          "Fn::Join": Array [
            "",
            Array [
              Object {
                "Ref": "SsmParameterValuecdkirmaissueappzonenameC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
              ".",
            ],
          ],
        },
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "cfcaching542C3664": Object {
      "Properties": Object {
        "CachePolicyConfig": Object {
          "DefaultTTL": 0,
          "MaxTTL": 1,
          "MinTTL": 0,
          "Name": "cfCachingSessionsIrmaIssueApp",
          "ParametersInCacheKeyAndForwardedToOrigin": Object {
            "CookiesConfig": Object {
              "CookieBehavior": "all",
            },
            "EnableAcceptEncodingBrotli": false,
            "EnableAcceptEncodingGzip": false,
            "HeadersConfig": Object {
              "HeaderBehavior": "whitelist",
              "Headers": Array [
                "Authorization",
              ],
            },
            "QueryStringsConfig": Object {
              "QueryStringBehavior": "all",
            },
          },
        },
      },
      "Type": "AWS::CloudFront::CachePolicy",
    },
    "cfdistributionC7035EBF": Object {
      "Properties": Object {
        "DistributionConfig": Object {
          "Aliases": Array [
            Object {
              "Ref": "SsmParameterValuecdkirmaissueappzonenameC96584B6F00A464EAD1953AFF4B05118Parameter",
            },
            "snapshot-tests.nijmegen.nl",
          ],
          "CacheBehaviors": Array [
            Object {
              "CachePolicyId": "658327ea-f89d-4fab-a63d-7e88639e58f6",
              "Compress": true,
              "PathPattern": "/static/*",
              "TargetOriginId": "apistagesnapshotcloudfrontstackcfdistributionOrigin2CF0C613E",
              "ViewerProtocolPolicy": "redirect-to-https",
            },
          ],
          "Comment": "IRMA issue app",
          "CustomErrorResponses": Array [
            Object {
              "ErrorCode": 403,
              "ResponseCode": 403,
              "ResponsePagePath": "/static/http-errors/403.html",
            },
            Object {
              "ErrorCode": 404,
              "ResponseCode": 404,
              "ResponsePagePath": "/static/http-errors/404.html",
            },
            Object {
              "ErrorCode": 500,
              "ResponseCode": 500,
              "ResponsePagePath": "/static/http-errors/500.html",
            },
            Object {
              "ErrorCode": 503,
              "ResponseCode": 503,
              "ResponsePagePath": "/static/http-errors/503.html",
            },
          ],
          "DefaultCacheBehavior": Object {
            "AllowedMethods": Array [
              "GET",
              "HEAD",
              "OPTIONS",
              "PUT",
              "PATCH",
              "POST",
              "DELETE",
            ],
            "CachePolicyId": Object {
              "Ref": "cfcaching542C3664",
            },
            "Compress": true,
            "OriginRequestPolicyId": Object {
              "Ref": "cforiginrequestpolicy80A90261",
            },
            "ResponseHeadersPolicyId": Object {
              "Ref": "headersBEE0BB4D",
            },
            "TargetOriginId": "apistagesnapshotcloudfrontstackcfdistributionOrigin127CBC36D",
            "ViewerProtocolPolicy": "redirect-to-https",
          },
          "DefaultRootObject": "issue",
          "Enabled": true,
          "HttpVersion": "http2",
          "IPV6Enabled": true,
          "Logging": Object {
            "Bucket": Object {
              "Fn::GetAtt": Array [
                "CloudfrontLogs7FFCD299",
                "RegionalDomainName",
              ],
            },
          },
          "Origins": Array [
            Object {
              "CustomOriginConfig": Object {
                "OriginProtocolPolicy": "https-only",
                "OriginSSLProtocols": Array [
                  "TLSv1.2",
                ],
              },
              "DomainName": Object {
                "Fn::Join": Array [
                  "",
                  Array [
                    Object {
                      "Fn::ImportValue": "api-stage-snapshot-api-stack:ExportsOutputRefirmaissueapiD1979B651B74DB4E",
                    },
                    ".execute-api.",
                    Object {
                      "Ref": "AWS::Region",
                    },
                    ".",
                    Object {
                      "Ref": "AWS::URLSuffix",
                    },
                  ],
                ],
              },
              "Id": "apistagesnapshotcloudfrontstackcfdistributionOrigin127CBC36D",
            },
            Object {
              "DomainName": Object {
                "Fn::GetAtt": Array [
                  "resourcesbucket8DBB515A",
                  "RegionalDomainName",
                ],
              },
              "Id": "apistagesnapshotcloudfrontstackcfdistributionOrigin2CF0C613E",
              "S3OriginConfig": Object {
                "OriginAccessIdentity": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "origin-access-identity/cloudfront/",
                      Object {
                        "Ref": "publicresourcesbucketoiaECDADD0D",
                      },
                    ],
                  ],
                },
              },
            },
          ],
          "PriceClass": "PriceClass_100",
          "ViewerCertificate": Object {
            "AcmCertificateArn": Object {
              "Fn::GetAtt": Array [
                "paramsSsmParameters67EAF4AF",
                "/cdk/irma-issue-app/certificates/certificate-arn",
              ],
            },
            "MinimumProtocolVersion": "TLSv1.2_2021",
            "SslSupportMethod": "sni-only",
          },
          "WebACLId": Object {
            "Fn::GetAtt": Array [
              "wafparamsSsmParametersFEAA8890",
              "/cdk/irma-issue-app/waf/acl-arn",
            ],
          },
        },
      },
      "Type": "AWS::CloudFront::Distribution",
    },
    "cforiginrequestpolicy80A90261": Object {
      "Properties": Object {
        "OriginRequestPolicyConfig": Object {
          "CookiesConfig": Object {
            "CookieBehavior": "none",
          },
          "HeadersConfig": Object {
            "HeaderBehavior": "whitelist",
            "Headers": Array [
              "Accept-Charset",
              "Origin",
              "Accept",
              "Referer",
              "Accept-Language",
              "Accept-Datetime",
              "Authoriz",
            ],
          },
          "Name": "cfOriginRequestPolicyIrmaIssueApp",
          "QueryStringsConfig": Object {
            "QueryStringBehavior": "none",
          },
        },
      },
      "Type": "AWS::CloudFront::OriginRequestPolicy",
    },
    "headersBEE0BB4D": Object {
      "Properties": Object {
        "ResponseHeadersPolicyConfig": Object {
          "Name": "apistagesnapshotcloudfrontstackheadersD1ED6DE3",
          "SecurityHeadersConfig": Object {
            "ContentSecurityPolicy": Object {
              "ContentSecurityPolicy": Object {
                "Fn::Join": Array [
                  "",
                  Array [
                    "default-src 'self'; frame-ancestors 'self'; frame-src 'self'; connect-src 'self' https://componenten.nijmegen.nl https://",
                    Object {
                      "Ref": "SsmParameterValuecdkirmaissueappirmaapihostC96584B6F00A464EAD1953AFF4B05118Parameter",
                    },
                    "; style-src 'self' https://componenten.nijmegen.nl https://fonts.googleapis.com https://fonts.gstatic.com 'sha256-hS1LM/30PjUBJK3kBX9Vm9eOAhQNCiNhf/SCDnUqu14=' 'sha256-47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU=' 'sha256-OTeu7NEHDo6qutIWo0F2TmYrDhsKWCzrUgGoxxHGJ8o='; script-src 'self' https://componenten.nijmegen.nl https://siteimproveanalytics.com; font-src 'self' https://componenten.nijmegen.nl https://fonts.gstatic.com; img-src 'self' https://componenten.nijmegen.nl data: https://*.siteimproveanalytics.io; object-src 'none';",
                  ],
                ],
              },
              "Override": true,
            },
            "ContentTypeOptions": Object {
              "Override": true,
            },
            "FrameOptions": Object {
              "FrameOption": "DENY",
              "Override": true,
            },
            "ReferrerPolicy": Object {
              "Override": true,
              "ReferrerPolicy": "no-referrer",
            },
            "StrictTransportSecurity": Object {
              "AccessControlMaxAgeSec": 31622400,
              "IncludeSubdomains": true,
              "Override": true,
            },
          },
        },
      },
      "Type": "AWS::CloudFront::ResponseHeadersPolicy",
    },
    "paramsMyHandlerDD014AA5": Object {
      "DependsOn": Array [
        "paramsMyHandlerServiceRoleDefaultPolicy19EAD401",
        "paramsMyHandlerServiceRole702761FB",
      ],
      "Properties": Object {
        "Code": Object {
          "S3Bucket": Object {
            "Fn::Sub": "cdk-hnb659fds-assets-\${AWS::AccountId}-\${AWS::Region}",
          },
          "S3Key": "3803df2f6849acf50bb6577ee095a669940670e799f70a2be34893a399777bc3.zip",
        },
        "Handler": "remote-parameters.on_event",
        "Role": Object {
          "Fn::GetAtt": Array [
            "paramsMyHandlerServiceRole702761FB",
            "Arn",
          ],
        },
        "Runtime": "python3.8",
      },
      "Type": "AWS::Lambda::Function",
    },
    "paramsMyHandlerServiceRole702761FB": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "paramsMyHandlerServiceRoleDefaultPolicy19EAD401": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "ssm:GetParametersByPath",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "paramsMyHandlerServiceRoleDefaultPolicy19EAD401",
        "Roles": Array [
          Object {
            "Ref": "paramsMyHandlerServiceRole702761FB",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "paramsMyProviderframeworkonEvent1CA04C43": Object {
      "DependsOn": Array [
        "paramsMyProviderframeworkonEventServiceRoleDefaultPolicy334F6117",
        "paramsMyProviderframeworkonEventServiceRole14F11254",
      ],
      "Properties": Object {
        "Code": Object {
          "S3Bucket": Object {
            "Fn::Sub": "cdk-hnb659fds-assets-\${AWS::AccountId}-\${AWS::Region}",
          },
          "S3Key": "2157f4ab8972014e220d70707296b292b3b7301f163f7cd641ccda0ee663530f.zip",
        },
        "Description": "AWS CDK resource provider framework - onEvent (api-stage-snapshot/cloudfront-stack/params/MyProvider)",
        "Environment": Object {
          "Variables": Object {
            "USER_ON_EVENT_FUNCTION_ARN": Object {
              "Fn::GetAtt": Array [
                "paramsMyHandlerDD014AA5",
                "Arn",
              ],
            },
          },
        },
        "Handler": "framework.onEvent",
        "Role": Object {
          "Fn::GetAtt": Array [
            "paramsMyProviderframeworkonEventServiceRole14F11254",
            "Arn",
          ],
        },
        "Runtime": "nodejs14.x",
        "Timeout": 900,
      },
      "Type": "AWS::Lambda::Function",
    },
    "paramsMyProviderframeworkonEventLogRetention9FFA785A": Object {
      "Properties": Object {
        "LogGroupName": Object {
          "Fn::Join": Array [
            "",
            Array [
              "/aws/lambda/",
              Object {
                "Ref": "paramsMyProviderframeworkonEvent1CA04C43",
              },
            ],
          ],
        },
        "RetentionInDays": 1,
        "ServiceToken": Object {
          "Fn::GetAtt": Array [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "paramsMyProviderframeworkonEventServiceRole14F11254": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "paramsMyProviderframeworkonEventServiceRoleDefaultPolicy334F6117": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": Array [
                Object {
                  "Fn::GetAtt": Array [
                    "paramsMyHandlerDD014AA5",
                    "Arn",
                  ],
                },
                Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      Object {
                        "Fn::GetAtt": Array [
                          "paramsMyHandlerDD014AA5",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "paramsMyProviderframeworkonEventServiceRoleDefaultPolicy334F6117",
        "Roles": Array [
          Object {
            "Ref": "paramsMyProviderframeworkonEventServiceRole14F11254",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "paramsSsmParameters67EAF4AF": Object {
      "DeletionPolicy": "Delete",
      "Properties": Object {
        "ServiceToken": Object {
          "Fn::GetAtt": Array [
            "paramsMyProviderframeworkonEvent1CA04C43",
            "Arn",
          ],
        },
        "parameterPath": "/cdk/irma-issue-app/certificates/",
        "regionName": "us-east-1",
        "stackName": "api-stage-snapshot-cloudfront-stack",
      },
      "Type": "AWS::CloudFormation::CustomResource",
      "UpdateReplacePolicy": "Delete",
    },
    "publicresourcesbucketoiaECDADD0D": Object {
      "Properties": Object {
        "CloudFrontOriginAccessIdentityConfig": Object {
          "Comment": "Allows CloudFront to reach the bucket",
        },
      },
      "Type": "AWS::CloudFront::CloudFrontOriginAccessIdentity",
    },
    "resourcesbucket8DBB515A": Object {
      "DeletionPolicy": "Retain",
      "Properties": Object {
        "PublicAccessBlockConfiguration": Object {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true,
        },
        "Tags": Array [
          Object {
            "Key": "aws-cdk:cr-owned:89a6282a",
            "Value": "true",
          },
        ],
      },
      "Type": "AWS::S3::Bucket",
      "UpdateReplacePolicy": "Retain",
    },
    "resourcesbucketNotificationsB82B70A2": Object {
      "Properties": Object {
        "BucketName": Object {
          "Ref": "resourcesbucket8DBB515A",
        },
        "Managed": true,
        "NotificationConfiguration": Object {
          "EventBridgeConfiguration": Object {},
        },
        "ServiceToken": Object {
          "Fn::GetAtt": Array [
            "BucketNotificationsHandler050a0587b7544547bf325f094a3db8347ECC3691",
            "Arn",
          ],
        },
      },
      "Type": "Custom::S3BucketNotifications",
    },
    "resourcesbucketPolicy5881FF0E": Object {
      "Properties": Object {
        "Bucket": Object {
          "Ref": "resourcesbucket8DBB515A",
        },
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "s3:*",
              "Condition": Object {
                "Bool": Object {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": Object {
                "AWS": "*",
              },
              "Resource": Array [
                Object {
                  "Fn::GetAtt": Array [
                    "resourcesbucket8DBB515A",
                    "Arn",
                  ],
                },
                Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      Object {
                        "Fn::GetAtt": Array [
                          "resourcesbucket8DBB515A",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            Object {
              "Action": Array [
                "s3:GetObject",
                "s3:ListBucket",
              ],
              "Effect": "Allow",
              "Principal": Object {
                "CanonicalUser": Object {
                  "Fn::GetAtt": Array [
                    "publicresourcesbucketoiaECDADD0D",
                    "S3CanonicalUserId",
                  ],
                },
              },
              "Resource": Array [
                Object {
                  "Fn::GetAtt": Array [
                    "resourcesbucket8DBB515A",
                    "Arn",
                  ],
                },
                Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      Object {
                        "Fn::GetAtt": Array [
                          "resourcesbucket8DBB515A",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            Object {
              "Action": "s3:GetObject",
              "Effect": "Allow",
              "Principal": Object {
                "CanonicalUser": Object {
                  "Fn::GetAtt": Array [
                    "publicresourcesbucketoiaECDADD0D",
                    "S3CanonicalUserId",
                  ],
                },
              },
              "Resource": Object {
                "Fn::Join": Array [
                  "",
                  Array [
                    Object {
                      "Fn::GetAtt": Array [
                        "resourcesbucket8DBB515A",
                        "Arn",
                      ],
                    },
                    "/*",
                  ],
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::S3::BucketPolicy",
    },
    "staticResourcesAwsCliLayer07A04ABC": Object {
      "Properties": Object {
        "Content": Object {
          "S3Bucket": Object {
            "Fn::Sub": "cdk-hnb659fds-assets-\${AWS::AccountId}-\${AWS::Region}",
          },
          "S3Key": "5d8d1d0aacea23824c62f362e1e3c14b7dd14a31c71b53bfae4d14a6373c5510.zip",
        },
        "Description": "/opt/awscli/aws",
      },
      "Type": "AWS::Lambda::LayerVersion",
    },
    "staticResourcesCustomResource6B7011F1": Object {
      "DeletionPolicy": "Delete",
      "Properties": Object {
        "DestinationBucketName": Object {
          "Ref": "resourcesbucket8DBB515A",
        },
        "DistributionId": Object {
          "Ref": "cfdistributionC7035EBF",
        },
        "DistributionPaths": Array [
          "/static/*",
        ],
        "Prune": true,
        "ServiceToken": Object {
          "Fn::GetAtt": Array [
            "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C81C01536",
            "Arn",
          ],
        },
        "SourceBucketNames": Array [
          Object {
            "Fn::Sub": "cdk-hnb659fds-assets-\${AWS::AccountId}-\${AWS::Region}",
          },
        ],
        "SourceObjectKeys": Array [
          "ed38f419a030b19287b12a9554adff8858b999e8627f093ccaecfd8d76a39521.zip",
        ],
      },
      "Type": "Custom::CDKBucketDeployment",
      "UpdateReplacePolicy": "Delete",
    },
    "wafparamsMyHandler392DAE06": Object {
      "DependsOn": Array [
        "wafparamsMyHandlerServiceRoleDefaultPolicy1CB811EF",
        "wafparamsMyHandlerServiceRole3DD5FAA2",
      ],
      "Properties": Object {
        "Code": Object {
          "S3Bucket": Object {
            "Fn::Sub": "cdk-hnb659fds-assets-\${AWS::AccountId}-\${AWS::Region}",
          },
          "S3Key": "3803df2f6849acf50bb6577ee095a669940670e799f70a2be34893a399777bc3.zip",
        },
        "Handler": "remote-parameters.on_event",
        "Role": Object {
          "Fn::GetAtt": Array [
            "wafparamsMyHandlerServiceRole3DD5FAA2",
            "Arn",
          ],
        },
        "Runtime": "python3.8",
      },
      "Type": "AWS::Lambda::Function",
    },
    "wafparamsMyHandlerServiceRole3DD5FAA2": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "wafparamsMyHandlerServiceRoleDefaultPolicy1CB811EF": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "ssm:GetParametersByPath",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "wafparamsMyHandlerServiceRoleDefaultPolicy1CB811EF",
        "Roles": Array [
          Object {
            "Ref": "wafparamsMyHandlerServiceRole3DD5FAA2",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "wafparamsMyProviderframeworkonEvent54FA48DC": Object {
      "DependsOn": Array [
        "wafparamsMyProviderframeworkonEventServiceRoleDefaultPolicy206B0D96",
        "wafparamsMyProviderframeworkonEventServiceRoleFD87CBE8",
      ],
      "Properties": Object {
        "Code": Object {
          "S3Bucket": Object {
            "Fn::Sub": "cdk-hnb659fds-assets-\${AWS::AccountId}-\${AWS::Region}",
          },
          "S3Key": "2157f4ab8972014e220d70707296b292b3b7301f163f7cd641ccda0ee663530f.zip",
        },
        "Description": "AWS CDK resource provider framework - onEvent (api-stage-snapshot/cloudfront-stack/waf-params/MyProvider)",
        "Environment": Object {
          "Variables": Object {
            "USER_ON_EVENT_FUNCTION_ARN": Object {
              "Fn::GetAtt": Array [
                "wafparamsMyHandler392DAE06",
                "Arn",
              ],
            },
          },
        },
        "Handler": "framework.onEvent",
        "Role": Object {
          "Fn::GetAtt": Array [
            "wafparamsMyProviderframeworkonEventServiceRoleFD87CBE8",
            "Arn",
          ],
        },
        "Runtime": "nodejs14.x",
        "Timeout": 900,
      },
      "Type": "AWS::Lambda::Function",
    },
    "wafparamsMyProviderframeworkonEventLogRetention277D342E": Object {
      "Properties": Object {
        "LogGroupName": Object {
          "Fn::Join": Array [
            "",
            Array [
              "/aws/lambda/",
              Object {
                "Ref": "wafparamsMyProviderframeworkonEvent54FA48DC",
              },
            ],
          ],
        },
        "RetentionInDays": 1,
        "ServiceToken": Object {
          "Fn::GetAtt": Array [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "wafparamsMyProviderframeworkonEventServiceRoleDefaultPolicy206B0D96": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": Array [
                Object {
                  "Fn::GetAtt": Array [
                    "wafparamsMyHandler392DAE06",
                    "Arn",
                  ],
                },
                Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      Object {
                        "Fn::GetAtt": Array [
                          "wafparamsMyHandler392DAE06",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "wafparamsMyProviderframeworkonEventServiceRoleDefaultPolicy206B0D96",
        "Roles": Array [
          Object {
            "Ref": "wafparamsMyProviderframeworkonEventServiceRoleFD87CBE8",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "wafparamsMyProviderframeworkonEventServiceRoleFD87CBE8": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "wafparamsSsmParametersFEAA8890": Object {
      "DeletionPolicy": "Delete",
      "Properties": Object {
        "ServiceToken": Object {
          "Fn::GetAtt": Array [
            "wafparamsMyProviderframeworkonEvent54FA48DC",
            "Arn",
          ],
        },
        "parameterPath": "/cdk/irma-issue-app/waf/",
        "regionName": "us-east-1",
        "stackName": "api-stage-snapshot-cloudfront-stack",
      },
      "Type": "AWS::CloudFormation::CustomResource",
      "UpdateReplacePolicy": "Delete",
    },
  },
  "Rules": Object {
    "CheckBootstrapVersion": Object {
      "Assertions": Array [
        Object {
          "Assert": Object {
            "Fn::Not": Array [
              Object {
                "Fn::Contains": Array [
                  Array [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  Object {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`ApiStage snapshot 8`] = `
Object {
  "Parameters": Object {
    "BootstrapVersion": Object {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuecdkirmaissueappstatisticsloggroupnameC96584B6F00A464EAD1953AFF4B05118Parameter": Object {
      "Default": "/cdk/irma-issue-app/statistics/log-group-name",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": Object {
    "dashboardC616E8C4": Object {
      "Properties": Object {
        "DashboardBody": Object {
          "Fn::Join": Array [
            "",
            Array [
              "{\\"widgets\\":[{\\"type\\":\\"log\\",\\"width\\":24,\\"height\\":6,\\"x\\":0,\\"y\\":0,\\"properties\\":{\\"view\\":\\"timeSeries\\",\\"title\\":\\"Issue events per hour\\",\\"region\\":\\"",
              Object {
                "Ref": "AWS::Region",
              },
              "\\",\\"query\\":\\"SOURCE '",
              Object {
                "Ref": "SsmParameterValuecdkirmaissueappstatisticsloggroupnameC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
              "' | fields success =  1 as r1, success = 0 as r2\\\\n| filter not isempty(subject)\\\\n| stats sum(r1) as successful, sum(r2) as failed by bin(1h)\\",\\"stacked\\":false}},{\\"type\\":\\"log\\",\\"width\\":8,\\"height\\":12,\\"x\\":0,\\"y\\":6,\\"properties\\":{\\"view\\":\\"pie\\",\\"title\\":\\"Issue events per gemeente\\",\\"region\\":\\"",
              Object {
                "Ref": "AWS::Region",
              },
              "\\",\\"query\\":\\"SOURCE '",
              Object {
                "Ref": "SsmParameterValuecdkirmaissueappstatisticsloggroupnameC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
              "' | fields subject, gemeente\\\\n| filter not isempty(subject)\\\\n| stats count(subject) as counts by gemeente\\\\n| sort gemeente\\"}},{\\"type\\":\\"log\\",\\"width\\":8,\\"height\\":12,\\"x\\":8,\\"y\\":6,\\"properties\\":{\\"view\\":\\"table\\",\\"title\\":\\"Issue events per gemeente\\",\\"region\\":\\"",
              Object {
                "Ref": "AWS::Region",
              },
              "\\",\\"query\\":\\"SOURCE '",
              Object {
                "Ref": "SsmParameterValuecdkirmaissueappstatisticsloggroupnameC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
              "' | fields subject, gemeente\\\\n| filter not isempty(subject)\\\\n| stats count(subject) as counts by gemeente\\\\n| sort gemeente\\"}},{\\"type\\":\\"log\\",\\"width\\":8,\\"height\\":12,\\"x\\":16,\\"y\\":6,\\"properties\\":{\\"view\\":\\"table\\",\\"title\\":\\"Multiple issue subjects\\",\\"region\\":\\"",
              Object {
                "Ref": "AWS::Region",
              },
              "\\",\\"query\\":\\"SOURCE '",
              Object {
                "Ref": "SsmParameterValuecdkirmaissueappstatisticsloggroupnameC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
              "' | fields gemeente\\\\n| filter not isempty(subject) and nr_of_issues_per_subject > 1\\\\n| stats count(subject) as nr_of_issues_per_subject by gemeente, subject\\"}},{\\"type\\":\\"log\\",\\"width\\":8,\\"height\\":12,\\"x\\":0,\\"y\\":18,\\"properties\\":{\\"view\\":\\"table\\",\\"title\\":\\"Errors and occurences\\",\\"region\\":\\"",
              Object {
                "Ref": "AWS::Region",
              },
              "\\",\\"query\\":\\"SOURCE '",
              Object {
                "Ref": "SsmParameterValuecdkirmaissueappstatisticsloggroupnameC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
              "' | fields error, nr_of_occurences\\\\n| stats count(error) as nr_of_occurences by error\\\\n| filter not isempty(subject) and not isempty(error) and error not like \\\\\\"undefined\\\\\\"\\"}}]}",
            ],
          ],
        },
        "DashboardName": "IRMA-issue-statistics",
      },
      "Type": "AWS::CloudWatch::Dashboard",
    },
  },
  "Rules": Object {
    "CheckBootstrapVersion": Object {
      "Assertions": Array [
        Object {
          "Assert": Object {
            "Fn::Not": Array [
              Object {
                "Fn::Contains": Array [
                  Array [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  Object {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`ApiStage snapshot 9`] = `
Object {
  "Parameters": Object {
    "BootstrapVersion": Object {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": Object {
    "irmaissueaclid74777EFA": Object {
      "Properties": Object {
        "Name": "/cdk/irma-issue-app/waf/acl-arn",
        "Type": "String",
        "Value": Object {
          "Fn::GetAtt": Array [
            "wafirmaIssueApp",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "wafirmaIssueApp": Object {
      "Properties": Object {
        "DefaultAction": Object {
          "Allow": Object {},
        },
        "Description": "used for the irma issue app",
        "Name": "irmaIssueAppWaf",
        "Rules": Array [
          Object {
            "Name": "AWS-ManagedRulesBotControlRuleSet",
            "OverrideAction": Object {
              "None": Object {},
            },
            "Priority": 0,
            "Statement": Object {
              "ManagedRuleGroupStatement": Object {
                "ExcludedRules": Array [
                  Object {
                    "Name": "SignalNonBrowserUserAgent",
                  },
                ],
                "Name": "AWSManagedRulesBotControlRuleSet",
                "VendorName": "AWS",
              },
            },
            "VisibilityConfig": Object {
              "CloudWatchMetricsEnabled": true,
              "MetricName": "AWS-ManagedRulesBotControlRuleSet",
              "SampledRequestsEnabled": true,
            },
          },
          Object {
            "Action": Object {
              "Block": Object {},
            },
            "Name": "BlockMostNonBrowserUserAgents",
            "Priority": 1,
            "RuleLabels": Array [],
            "Statement": Object {
              "AndStatement": Object {
                "Statements": Array [
                  Object {
                    "LabelMatchStatement": Object {
                      "Key": "awswaf:managed:aws:bot-control:signal:non_browser_user_agent",
                      "Scope": "LABEL",
                    },
                  },
                  Object {
                    "NotStatement": Object {
                      "Statement": Object {
                        "ByteMatchStatement": Object {
                          "FieldToMatch": Object {
                            "SingleHeader": Object {
                              "Name": "user-agent",
                            },
                          },
                          "PositionalConstraint": "EXACTLY",
                          "SearchString": "internetnl/1.0",
                          "TextTransformations": Array [
                            Object {
                              "Priority": 0,
                              "Type": "NONE",
                            },
                          ],
                        },
                      },
                    },
                  },
                ],
              },
            },
            "VisibilityConfig": Object {
              "CloudWatchMetricsEnabled": true,
              "MetricName": "AWS-ManagedRulesBotControlRuleSet",
              "SampledRequestsEnabled": true,
            },
          },
          Object {
            "Action": Object {
              "Count": Object {},
            },
            "Name": "RateBasedStatement",
            "Priority": 10,
            "Statement": Object {
              "RateBasedStatement": Object {
                "AggregateKeyType": "IP",
                "Limit": 500,
              },
            },
            "VisibilityConfig": Object {
              "CloudWatchMetricsEnabled": true,
              "MetricName": "AWS-RateBasedStatement",
              "SampledRequestsEnabled": true,
            },
          },
          Object {
            "Name": "AWS-AmazonIpReputationList",
            "OverrideAction": Object {
              "None": Object {},
            },
            "Priority": 20,
            "Statement": Object {
              "ManagedRuleGroupStatement": Object {
                "Name": "AWSManagedRulesAmazonIpReputationList",
                "VendorName": "AWS",
              },
            },
            "VisibilityConfig": Object {
              "CloudWatchMetricsEnabled": true,
              "MetricName": "AWS-AmazonIpReputationList",
              "SampledRequestsEnabled": true,
            },
          },
          Object {
            "Name": "AWS-AWSManagedRulesCommonRuleSet",
            "OverrideAction": Object {
              "None": Object {},
            },
            "Priority": 30,
            "Statement": Object {
              "ManagedRuleGroupStatement": Object {
                "Name": "AWSManagedRulesCommonRuleSet",
                "VendorName": "AWS",
              },
            },
            "VisibilityConfig": Object {
              "CloudWatchMetricsEnabled": true,
              "MetricName": "AWS-AWSManagedRulesCommonRuleSet",
              "SampledRequestsEnabled": true,
            },
          },
        ],
        "Scope": "CLOUDFRONT",
        "VisibilityConfig": Object {
          "CloudWatchMetricsEnabled": true,
          "MetricName": "irmaIssueApp-web-acl",
          "SampledRequestsEnabled": true,
        },
      },
      "Type": "AWS::WAFv2::WebACL",
    },
    "waflogging": Object {
      "Properties": Object {
        "LogDestinationConfigs": Array [
          Object {
            "Fn::Join": Array [
              "",
              Array [
                "arn:",
                Object {
                  "Ref": "AWS::Partition",
                },
                ":logs:us-east-1:",
                Object {
                  "Ref": "AWS::AccountId",
                },
                ":log-group:",
                Object {
                  "Ref": "waflogs491765AC",
                },
              ],
            ],
          },
        ],
        "ResourceArn": Object {
          "Fn::GetAtt": Array [
            "wafirmaIssueApp",
            "Arn",
          ],
        },
      },
      "Type": "AWS::WAFv2::LoggingConfiguration",
    },
    "waflogs491765AC": Object {
      "DeletionPolicy": "Retain",
      "Properties": Object {
        "LogGroupName": "aws-waf-logs-irma-issue-app",
        "RetentionInDays": 731,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
  },
  "Rules": Object {
    "CheckBootstrapVersion": Object {
      "Assertions": Array [
        Object {
          "Assert": Object {
            "Fn::Not": Array [
              Object {
                "Fn::Contains": Array [
                  Array [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  Object {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Snapshot pipeline 1`] = `
Object {
  "Parameters": Object {
    "BootstrapVersion": Object {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": Object {
    "irmaissueappsnapshottestsAssetsFileAsset10F465841C": Object {
      "Properties": Object {
        "Artifacts": Object {
          "Type": "CODEPIPELINE",
        },
        "Cache": Object {
          "Type": "NO_CACHE",
        },
        "Description": "Pipeline step test/Pipeline/Assets/FileAsset10",
        "EncryptionKey": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsPipelineArtifactsBucketEncryptionKeyEA37D987",
            "Arn",
          ],
        },
        "Environment": Object {
          "ComputeType": "BUILD_GENERAL1_SMALL",
          "Image": "aws/codebuild/standard:5.0",
          "ImagePullCredentialsType": "CODEBUILD",
          "PrivilegedMode": false,
          "Type": "LINUX_CONTAINER",
        },
        "ServiceRole": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsAssetsFileRole25C24532",
            "Arn",
          ],
        },
        "Source": Object {
          "BuildSpec": "{
  \\"version\\": \\"0.2\\",
  \\"phases\\": {
    \\"install\\": {
      \\"commands\\": [
        \\"npm install -g cdk-assets@2\\"
      ]
    },
    \\"build\\": {
      \\"commands\\": [
        \\"cdk-assets --path \\\\\\"assembly-test-irma-issue-api/testirmaissueapicloudfrontstackE66D8EBF.assets.json\\\\\\" --verbose publish \\\\\\"5d8d1d0aacea23824c62f362e1e3c14b7dd14a31c71b53bfae4d14a6373c5510:123456789012-eu-central-1\\\\\\"\\"
      ]
    }
  }
}",
          "Type": "CODEPIPELINE",
        },
        "Tags": Array [
          Object {
            "Key": "cdkManaged",
            "Value": "yes",
          },
          Object {
            "Key": "Project",
            "Value": "irma-issue-app",
          },
        ],
      },
      "Type": "AWS::CodeBuild::Project",
    },
    "irmaissueappsnapshottestsAssetsFileAsset11C35B121E": Object {
      "Properties": Object {
        "Artifacts": Object {
          "Type": "CODEPIPELINE",
        },
        "Cache": Object {
          "Type": "NO_CACHE",
        },
        "Description": "Pipeline step test/Pipeline/Assets/FileAsset11",
        "EncryptionKey": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsPipelineArtifactsBucketEncryptionKeyEA37D987",
            "Arn",
          ],
        },
        "Environment": Object {
          "ComputeType": "BUILD_GENERAL1_SMALL",
          "Image": "aws/codebuild/standard:5.0",
          "ImagePullCredentialsType": "CODEBUILD",
          "PrivilegedMode": false,
          "Type": "LINUX_CONTAINER",
        },
        "ServiceRole": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsAssetsFileRole25C24532",
            "Arn",
          ],
        },
        "Source": Object {
          "BuildSpec": "{
  \\"version\\": \\"0.2\\",
  \\"phases\\": {
    \\"install\\": {
      \\"commands\\": [
        \\"npm install -g cdk-assets@2\\"
      ]
    },
    \\"build\\": {
      \\"commands\\": [
        \\"cdk-assets --path \\\\\\"assembly-test-irma-issue-api/testirmaissueapicloudfrontstackE66D8EBF.assets.json\\\\\\" --verbose publish \\\\\\"2bc265c5e0569aeb24a6349c15bd54e76e845892376515e036627ab0cc70bb64:123456789012-eu-central-1\\\\\\"\\"
      ]
    }
  }
}",
          "Type": "CODEPIPELINE",
        },
        "Tags": Array [
          Object {
            "Key": "cdkManaged",
            "Value": "yes",
          },
          Object {
            "Key": "Project",
            "Value": "irma-issue-app",
          },
        ],
      },
      "Type": "AWS::CodeBuild::Project",
    },
    "irmaissueappsnapshottestsAssetsFileAsset11EF7834D": Object {
      "Properties": Object {
        "Artifacts": Object {
          "Type": "CODEPIPELINE",
        },
        "Cache": Object {
          "Type": "NO_CACHE",
        },
        "Description": "Pipeline step test/Pipeline/Assets/FileAsset1",
        "EncryptionKey": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsPipelineArtifactsBucketEncryptionKeyEA37D987",
            "Arn",
          ],
        },
        "Environment": Object {
          "ComputeType": "BUILD_GENERAL1_SMALL",
          "Image": "aws/codebuild/standard:5.0",
          "ImagePullCredentialsType": "CODEBUILD",
          "PrivilegedMode": false,
          "Type": "LINUX_CONTAINER",
        },
        "ServiceRole": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsAssetsFileRole25C24532",
            "Arn",
          ],
        },
        "Source": Object {
          "BuildSpec": "{
  \\"version\\": \\"0.2\\",
  \\"phases\\": {
    \\"install\\": {
      \\"commands\\": [
        \\"npm install -g cdk-assets@2\\"
      ]
    },
    \\"build\\": {
      \\"commands\\": [
        \\"cdk-assets --path \\\\\\"assembly-test-irma-issue-api/testirmaissueapidnssecstack22548CE5.assets.json\\\\\\" --verbose publish \\\\\\"3803df2f6849acf50bb6577ee095a669940670e799f70a2be34893a399777bc3:123456789012-us-east-1\\\\\\"\\",
        \\"cdk-assets --path \\\\\\"assembly-test-irma-issue-api/testirmaissueapicloudfrontstackE66D8EBF.assets.json\\\\\\" --verbose publish \\\\\\"3803df2f6849acf50bb6577ee095a669940670e799f70a2be34893a399777bc3:123456789012-eu-central-1\\\\\\"\\"
      ]
    }
  }
}",
          "Type": "CODEPIPELINE",
        },
        "Tags": Array [
          Object {
            "Key": "cdkManaged",
            "Value": "yes",
          },
          Object {
            "Key": "Project",
            "Value": "irma-issue-app",
          },
        ],
      },
      "Type": "AWS::CodeBuild::Project",
    },
    "irmaissueappsnapshottestsAssetsFileAsset1263AA13EC": Object {
      "Properties": Object {
        "Artifacts": Object {
          "Type": "CODEPIPELINE",
        },
        "Cache": Object {
          "Type": "NO_CACHE",
        },
        "Description": "Pipeline step test/Pipeline/Assets/FileAsset12",
        "EncryptionKey": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsPipelineArtifactsBucketEncryptionKeyEA37D987",
            "Arn",
          ],
        },
        "Environment": Object {
          "ComputeType": "BUILD_GENERAL1_SMALL",
          "Image": "aws/codebuild/standard:5.0",
          "ImagePullCredentialsType": "CODEBUILD",
          "PrivilegedMode": false,
          "Type": "LINUX_CONTAINER",
        },
        "ServiceRole": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsAssetsFileRole25C24532",
            "Arn",
          ],
        },
        "Source": Object {
          "BuildSpec": "{
  \\"version\\": \\"0.2\\",
  \\"phases\\": {
    \\"install\\": {
      \\"commands\\": [
        \\"npm install -g cdk-assets@2\\"
      ]
    },
    \\"build\\": {
      \\"commands\\": [
        \\"cdk-assets --path \\\\\\"assembly-test-irma-issue-api/testirmaissueapicloudfrontstackE66D8EBF.assets.json\\\\\\" --verbose publish \\\\\\"ed38f419a030b19287b12a9554adff8858b999e8627f093ccaecfd8d76a39521:123456789012-eu-central-1\\\\\\"\\"
      ]
    }
  }
}",
          "Type": "CODEPIPELINE",
        },
        "Tags": Array [
          Object {
            "Key": "cdkManaged",
            "Value": "yes",
          },
          Object {
            "Key": "Project",
            "Value": "irma-issue-app",
          },
        ],
      },
      "Type": "AWS::CodeBuild::Project",
    },
    "irmaissueappsnapshottestsAssetsFileAsset2B38A383A": Object {
      "Properties": Object {
        "Artifacts": Object {
          "Type": "CODEPIPELINE",
        },
        "Cache": Object {
          "Type": "NO_CACHE",
        },
        "Description": "Pipeline step test/Pipeline/Assets/FileAsset2",
        "EncryptionKey": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsPipelineArtifactsBucketEncryptionKeyEA37D987",
            "Arn",
          ],
        },
        "Environment": Object {
          "ComputeType": "BUILD_GENERAL1_SMALL",
          "Image": "aws/codebuild/standard:5.0",
          "ImagePullCredentialsType": "CODEBUILD",
          "PrivilegedMode": false,
          "Type": "LINUX_CONTAINER",
        },
        "ServiceRole": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsAssetsFileRole25C24532",
            "Arn",
          ],
        },
        "Source": Object {
          "BuildSpec": "{
  \\"version\\": \\"0.2\\",
  \\"phases\\": {
    \\"install\\": {
      \\"commands\\": [
        \\"npm install -g cdk-assets@2\\"
      ]
    },
    \\"build\\": {
      \\"commands\\": [
        \\"cdk-assets --path \\\\\\"assembly-test-irma-issue-api/testirmaissueapidnssecstack22548CE5.assets.json\\\\\\" --verbose publish \\\\\\"2157f4ab8972014e220d70707296b292b3b7301f163f7cd641ccda0ee663530f:123456789012-us-east-1\\\\\\"\\",
        \\"cdk-assets --path \\\\\\"assembly-test-irma-issue-api/testirmaissueapicloudfrontstackE66D8EBF.assets.json\\\\\\" --verbose publish \\\\\\"2157f4ab8972014e220d70707296b292b3b7301f163f7cd641ccda0ee663530f:123456789012-eu-central-1\\\\\\"\\"
      ]
    }
  }
}",
          "Type": "CODEPIPELINE",
        },
        "Tags": Array [
          Object {
            "Key": "cdkManaged",
            "Value": "yes",
          },
          Object {
            "Key": "Project",
            "Value": "irma-issue-app",
          },
        ],
      },
      "Type": "AWS::CodeBuild::Project",
    },
    "irmaissueappsnapshottestsAssetsFileAsset3747F7373": Object {
      "Properties": Object {
        "Artifacts": Object {
          "Type": "CODEPIPELINE",
        },
        "Cache": Object {
          "Type": "NO_CACHE",
        },
        "Description": "Pipeline step test/Pipeline/Assets/FileAsset3",
        "EncryptionKey": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsPipelineArtifactsBucketEncryptionKeyEA37D987",
            "Arn",
          ],
        },
        "Environment": Object {
          "ComputeType": "BUILD_GENERAL1_SMALL",
          "Image": "aws/codebuild/standard:5.0",
          "ImagePullCredentialsType": "CODEBUILD",
          "PrivilegedMode": false,
          "Type": "LINUX_CONTAINER",
        },
        "ServiceRole": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsAssetsFileRole25C24532",
            "Arn",
          ],
        },
        "Source": Object {
          "BuildSpec": "{
  \\"version\\": \\"0.2\\",
  \\"phases\\": {
    \\"install\\": {
      \\"commands\\": [
        \\"npm install -g cdk-assets@2\\"
      ]
    },
    \\"build\\": {
      \\"commands\\": [
        \\"cdk-assets --path \\\\\\"assembly-test-irma-issue-api/testirmaissueapidnssecstack22548CE5.assets.json\\\\\\" --verbose publish \\\\\\"eb5b005c858404ea0c8f68098ed5dcdf5340e02461f149751d10f59c210d5ef8:123456789012-us-east-1\\\\\\"\\",
        \\"cdk-assets --path \\\\\\"assembly-test-irma-issue-api/testirmaissueapiapistack38F434B4.assets.json\\\\\\" --verbose publish \\\\\\"eb5b005c858404ea0c8f68098ed5dcdf5340e02461f149751d10f59c210d5ef8:123456789012-eu-central-1\\\\\\"\\"
      ]
    }
  }
}",
          "Type": "CODEPIPELINE",
        },
        "Tags": Array [
          Object {
            "Key": "cdkManaged",
            "Value": "yes",
          },
          Object {
            "Key": "Project",
            "Value": "irma-issue-app",
          },
        ],
      },
      "Type": "AWS::CodeBuild::Project",
    },
    "irmaissueappsnapshottestsAssetsFileAsset403983B77": Object {
      "Properties": Object {
        "Artifacts": Object {
          "Type": "CODEPIPELINE",
        },
        "Cache": Object {
          "Type": "NO_CACHE",
        },
        "Description": "Pipeline step test/Pipeline/Assets/FileAsset4",
        "EncryptionKey": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsPipelineArtifactsBucketEncryptionKeyEA37D987",
            "Arn",
          ],
        },
        "Environment": Object {
          "ComputeType": "BUILD_GENERAL1_SMALL",
          "Image": "aws/codebuild/standard:5.0",
          "ImagePullCredentialsType": "CODEBUILD",
          "PrivilegedMode": false,
          "Type": "LINUX_CONTAINER",
        },
        "ServiceRole": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsAssetsFileRole25C24532",
            "Arn",
          ],
        },
        "Source": Object {
          "BuildSpec": "{
  \\"version\\": \\"0.2\\",
  \\"phases\\": {
    \\"install\\": {
      \\"commands\\": [
        \\"npm install -g cdk-assets@2\\"
      ]
    },
    \\"build\\": {
      \\"commands\\": [
        \\"cdk-assets --path \\\\\\"assembly-test-irma-issue-api/testirmaissueapidnssecstack22548CE5.assets.json\\\\\\" --verbose publish \\\\\\"04aae5aa9e9ed5e0aeefb4bbbfb82449ef35f3db68a98770c2e5cc4237666963:123456789012-us-east-1\\\\\\"\\"
      ]
    }
  }
}",
          "Type": "CODEPIPELINE",
        },
        "Tags": Array [
          Object {
            "Key": "cdkManaged",
            "Value": "yes",
          },
          Object {
            "Key": "Project",
            "Value": "irma-issue-app",
          },
        ],
      },
      "Type": "AWS::CodeBuild::Project",
    },
    "irmaissueappsnapshottestsAssetsFileAsset529E787FE": Object {
      "Properties": Object {
        "Artifacts": Object {
          "Type": "CODEPIPELINE",
        },
        "Cache": Object {
          "Type": "NO_CACHE",
        },
        "Description": "Pipeline step test/Pipeline/Assets/FileAsset5",
        "EncryptionKey": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsPipelineArtifactsBucketEncryptionKeyEA37D987",
            "Arn",
          ],
        },
        "Environment": Object {
          "ComputeType": "BUILD_GENERAL1_SMALL",
          "Image": "aws/codebuild/standard:5.0",
          "ImagePullCredentialsType": "CODEBUILD",
          "PrivilegedMode": false,
          "Type": "LINUX_CONTAINER",
        },
        "ServiceRole": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsAssetsFileRole25C24532",
            "Arn",
          ],
        },
        "Source": Object {
          "BuildSpec": "{
  \\"version\\": \\"0.2\\",
  \\"phases\\": {
    \\"install\\": {
      \\"commands\\": [
        \\"npm install -g cdk-assets@2\\"
      ]
    },
    \\"build\\": {
      \\"commands\\": [
        \\"cdk-assets --path \\\\\\"assembly-test-irma-issue-api/testirmaissueapiapistack38F434B4.assets.json\\\\\\" --verbose publish \\\\\\"bd8181c8f51323814bd07c84b2b80b802f9d199b2e47fd027fc4f0f16b01b553:123456789012-eu-central-1\\\\\\"\\"
      ]
    }
  }
}",
          "Type": "CODEPIPELINE",
        },
        "Tags": Array [
          Object {
            "Key": "cdkManaged",
            "Value": "yes",
          },
          Object {
            "Key": "Project",
            "Value": "irma-issue-app",
          },
        ],
      },
      "Type": "AWS::CodeBuild::Project",
    },
    "irmaissueappsnapshottestsAssetsFileAsset61692BDD4": Object {
      "Properties": Object {
        "Artifacts": Object {
          "Type": "CODEPIPELINE",
        },
        "Cache": Object {
          "Type": "NO_CACHE",
        },
        "Description": "Pipeline step test/Pipeline/Assets/FileAsset6",
        "EncryptionKey": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsPipelineArtifactsBucketEncryptionKeyEA37D987",
            "Arn",
          ],
        },
        "Environment": Object {
          "ComputeType": "BUILD_GENERAL1_SMALL",
          "Image": "aws/codebuild/standard:5.0",
          "ImagePullCredentialsType": "CODEBUILD",
          "PrivilegedMode": false,
          "Type": "LINUX_CONTAINER",
        },
        "ServiceRole": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsAssetsFileRole25C24532",
            "Arn",
          ],
        },
        "Source": Object {
          "BuildSpec": "{
  \\"version\\": \\"0.2\\",
  \\"phases\\": {
    \\"install\\": {
      \\"commands\\": [
        \\"npm install -g cdk-assets@2\\"
      ]
    },
    \\"build\\": {
      \\"commands\\": [
        \\"cdk-assets --path \\\\\\"assembly-test-irma-issue-api/testirmaissueapiapistack38F434B4.assets.json\\\\\\" --verbose publish \\\\\\"25b801d36f937be1d91523cd9fa6cfb0fb5d47f413d086d044910909d3861c24:123456789012-eu-central-1\\\\\\"\\"
      ]
    }
  }
}",
          "Type": "CODEPIPELINE",
        },
        "Tags": Array [
          Object {
            "Key": "cdkManaged",
            "Value": "yes",
          },
          Object {
            "Key": "Project",
            "Value": "irma-issue-app",
          },
        ],
      },
      "Type": "AWS::CodeBuild::Project",
    },
    "irmaissueappsnapshottestsAssetsFileAsset78DA11727": Object {
      "Properties": Object {
        "Artifacts": Object {
          "Type": "CODEPIPELINE",
        },
        "Cache": Object {
          "Type": "NO_CACHE",
        },
        "Description": "Pipeline step test/Pipeline/Assets/FileAsset7",
        "EncryptionKey": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsPipelineArtifactsBucketEncryptionKeyEA37D987",
            "Arn",
          ],
        },
        "Environment": Object {
          "ComputeType": "BUILD_GENERAL1_SMALL",
          "Image": "aws/codebuild/standard:5.0",
          "ImagePullCredentialsType": "CODEBUILD",
          "PrivilegedMode": false,
          "Type": "LINUX_CONTAINER",
        },
        "ServiceRole": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsAssetsFileRole25C24532",
            "Arn",
          ],
        },
        "Source": Object {
          "BuildSpec": "{
  \\"version\\": \\"0.2\\",
  \\"phases\\": {
    \\"install\\": {
      \\"commands\\": [
        \\"npm install -g cdk-assets@2\\"
      ]
    },
    \\"build\\": {
      \\"commands\\": [
        \\"cdk-assets --path \\\\\\"assembly-test-irma-issue-api/testirmaissueapiapistack38F434B4.assets.json\\\\\\" --verbose publish \\\\\\"41c9cca0546e1a301995a2de090e26279c2577cf00d25bdbc4372d634d6ed3bc:123456789012-eu-central-1\\\\\\"\\"
      ]
    }
  }
}",
          "Type": "CODEPIPELINE",
        },
        "Tags": Array [
          Object {
            "Key": "cdkManaged",
            "Value": "yes",
          },
          Object {
            "Key": "Project",
            "Value": "irma-issue-app",
          },
        ],
      },
      "Type": "AWS::CodeBuild::Project",
    },
    "irmaissueappsnapshottestsAssetsFileAsset8FB8D86DA": Object {
      "Properties": Object {
        "Artifacts": Object {
          "Type": "CODEPIPELINE",
        },
        "Cache": Object {
          "Type": "NO_CACHE",
        },
        "Description": "Pipeline step test/Pipeline/Assets/FileAsset8",
        "EncryptionKey": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsPipelineArtifactsBucketEncryptionKeyEA37D987",
            "Arn",
          ],
        },
        "Environment": Object {
          "ComputeType": "BUILD_GENERAL1_SMALL",
          "Image": "aws/codebuild/standard:5.0",
          "ImagePullCredentialsType": "CODEBUILD",
          "PrivilegedMode": false,
          "Type": "LINUX_CONTAINER",
        },
        "ServiceRole": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsAssetsFileRole25C24532",
            "Arn",
          ],
        },
        "Source": Object {
          "BuildSpec": "{
  \\"version\\": \\"0.2\\",
  \\"phases\\": {
    \\"install\\": {
      \\"commands\\": [
        \\"npm install -g cdk-assets@2\\"
      ]
    },
    \\"build\\": {
      \\"commands\\": [
        \\"cdk-assets --path \\\\\\"assembly-test-irma-issue-api/testirmaissueapiapistack38F434B4.assets.json\\\\\\" --verbose publish \\\\\\"92a3964a1f73da3726bd89af34333021ed8f59a3055e27258350064ae0ddf7fb:123456789012-eu-central-1\\\\\\"\\"
      ]
    }
  }
}",
          "Type": "CODEPIPELINE",
        },
        "Tags": Array [
          Object {
            "Key": "cdkManaged",
            "Value": "yes",
          },
          Object {
            "Key": "Project",
            "Value": "irma-issue-app",
          },
        ],
      },
      "Type": "AWS::CodeBuild::Project",
    },
    "irmaissueappsnapshottestsAssetsFileAsset9EA490E16": Object {
      "Properties": Object {
        "Artifacts": Object {
          "Type": "CODEPIPELINE",
        },
        "Cache": Object {
          "Type": "NO_CACHE",
        },
        "Description": "Pipeline step test/Pipeline/Assets/FileAsset9",
        "EncryptionKey": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsPipelineArtifactsBucketEncryptionKeyEA37D987",
            "Arn",
          ],
        },
        "Environment": Object {
          "ComputeType": "BUILD_GENERAL1_SMALL",
          "Image": "aws/codebuild/standard:5.0",
          "ImagePullCredentialsType": "CODEBUILD",
          "PrivilegedMode": false,
          "Type": "LINUX_CONTAINER",
        },
        "ServiceRole": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsAssetsFileRole25C24532",
            "Arn",
          ],
        },
        "Source": Object {
          "BuildSpec": "{
  \\"version\\": \\"0.2\\",
  \\"phases\\": {
    \\"install\\": {
      \\"commands\\": [
        \\"npm install -g cdk-assets@2\\"
      ]
    },
    \\"build\\": {
      \\"commands\\": [
        \\"cdk-assets --path \\\\\\"assembly-test-irma-issue-api/testirmaissueapiapistack38F434B4.assets.json\\\\\\" --verbose publish \\\\\\"fa7fa4e7df764856ab205ccd2de19e133aa80576c89fd3a194a851c342f5e67c:123456789012-eu-central-1\\\\\\"\\"
      ]
    }
  }
}",
          "Type": "CODEPIPELINE",
        },
        "Tags": Array [
          Object {
            "Key": "cdkManaged",
            "Value": "yes",
          },
          Object {
            "Key": "Project",
            "Value": "irma-issue-app",
          },
        ],
      },
      "Type": "AWS::CodeBuild::Project",
    },
    "irmaissueappsnapshottestsAssetsFileRole25C24532": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "codebuild.amazonaws.com",
              },
            },
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "AWS": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::test:root",
                    ],
                  ],
                },
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Tags": Array [
          Object {
            "Key": "cdkManaged",
            "Value": "yes",
          },
          Object {
            "Key": "Project",
            "Value": "irma-issue-app",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "irmaissueappsnapshottestsAssetsFileRoleDefaultPolicy5BDCE0E6": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": Array [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::Join": Array [
                  "",
                  Array [
                    "arn:",
                    Object {
                      "Ref": "AWS::Partition",
                    },
                    ":logs:eu-west-1:test:log-group:/aws/codebuild/*",
                  ],
                ],
              },
            },
            Object {
              "Action": Array [
                "codebuild:CreateReportGroup",
                "codebuild:CreateReport",
                "codebuild:UpdateReport",
                "codebuild:BatchPutTestCases",
                "codebuild:BatchPutCodeCoverages",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::Join": Array [
                  "",
                  Array [
                    "arn:",
                    Object {
                      "Ref": "AWS::Partition",
                    },
                    ":codebuild:eu-west-1:test:report-group/*",
                  ],
                ],
              },
            },
            Object {
              "Action": Array [
                "codebuild:BatchGetBuilds",
                "codebuild:StartBuild",
                "codebuild:StopBuild",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Resource": Array [
                Object {
                  "Fn::Sub": "arn:\${AWS::Partition}:iam::123456789012:role/cdk-hnb659fds-file-publishing-role-123456789012-us-east-1",
                },
                Object {
                  "Fn::Sub": "arn:\${AWS::Partition}:iam::123456789012:role/cdk-hnb659fds-file-publishing-role-123456789012-eu-central-1",
                },
              ],
            },
            Object {
              "Action": Array [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
              ],
              "Effect": "Allow",
              "Resource": Array [
                Object {
                  "Fn::GetAtt": Array [
                    "irmaissueappsnapshottestsPipelineArtifactsBucketD339BDC8",
                    "Arn",
                  ],
                },
                Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      Object {
                        "Fn::GetAtt": Array [
                          "irmaissueappsnapshottestsPipelineArtifactsBucketD339BDC8",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            Object {
              "Action": Array [
                "kms:Decrypt",
                "kms:DescribeKey",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissueappsnapshottestsPipelineArtifactsBucketEncryptionKeyEA37D987",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "irmaissueappsnapshottestsAssetsFileRoleDefaultPolicy5BDCE0E6",
        "Roles": Array [
          Object {
            "Ref": "irmaissueappsnapshottestsAssetsFileRole25C24532",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "irmaissueappsnapshottestsCodeBuildActionRole6E969778": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Condition": Object {
                "Bool": Object {
                  "aws:ViaAWSService": "codepipeline.amazonaws.com",
                },
              },
              "Effect": "Allow",
              "Principal": Object {
                "AWS": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::test:root",
                    ],
                  ],
                },
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Tags": Array [
          Object {
            "Key": "cdkManaged",
            "Value": "yes",
          },
          Object {
            "Key": "Project",
            "Value": "irma-issue-app",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "irmaissueappsnapshottestsCodeBuildActionRoleDefaultPolicy00787E5E": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": Array [
                "codebuild:BatchGetBuilds",
                "codebuild:StartBuild",
                "codebuild:StopBuild",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissueappsnapshottestsPipelineBuildSynthCdkBuildProject0ED6A888",
                  "Arn",
                ],
              },
            },
            Object {
              "Action": Array [
                "codebuild:BatchGetBuilds",
                "codebuild:StartBuild",
                "codebuild:StopBuild",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissueappsnapshottestsUpdatePipelineSelfMutation94934255",
                  "Arn",
                ],
              },
            },
            Object {
              "Action": Array [
                "codebuild:BatchGetBuilds",
                "codebuild:StartBuild",
                "codebuild:StopBuild",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissueappsnapshottestsAssetsFileAsset11EF7834D",
                  "Arn",
                ],
              },
            },
            Object {
              "Action": Array [
                "codebuild:BatchGetBuilds",
                "codebuild:StartBuild",
                "codebuild:StopBuild",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissueappsnapshottestsAssetsFileAsset10F465841C",
                  "Arn",
                ],
              },
            },
            Object {
              "Action": Array [
                "codebuild:BatchGetBuilds",
                "codebuild:StartBuild",
                "codebuild:StopBuild",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissueappsnapshottestsAssetsFileAsset11C35B121E",
                  "Arn",
                ],
              },
            },
            Object {
              "Action": Array [
                "codebuild:BatchGetBuilds",
                "codebuild:StartBuild",
                "codebuild:StopBuild",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissueappsnapshottestsAssetsFileAsset1263AA13EC",
                  "Arn",
                ],
              },
            },
            Object {
              "Action": Array [
                "codebuild:BatchGetBuilds",
                "codebuild:StartBuild",
                "codebuild:StopBuild",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissueappsnapshottestsAssetsFileAsset2B38A383A",
                  "Arn",
                ],
              },
            },
            Object {
              "Action": Array [
                "codebuild:BatchGetBuilds",
                "codebuild:StartBuild",
                "codebuild:StopBuild",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissueappsnapshottestsAssetsFileAsset3747F7373",
                  "Arn",
                ],
              },
            },
            Object {
              "Action": Array [
                "codebuild:BatchGetBuilds",
                "codebuild:StartBuild",
                "codebuild:StopBuild",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissueappsnapshottestsAssetsFileAsset403983B77",
                  "Arn",
                ],
              },
            },
            Object {
              "Action": Array [
                "codebuild:BatchGetBuilds",
                "codebuild:StartBuild",
                "codebuild:StopBuild",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissueappsnapshottestsAssetsFileAsset529E787FE",
                  "Arn",
                ],
              },
            },
            Object {
              "Action": Array [
                "codebuild:BatchGetBuilds",
                "codebuild:StartBuild",
                "codebuild:StopBuild",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissueappsnapshottestsAssetsFileAsset61692BDD4",
                  "Arn",
                ],
              },
            },
            Object {
              "Action": Array [
                "codebuild:BatchGetBuilds",
                "codebuild:StartBuild",
                "codebuild:StopBuild",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissueappsnapshottestsAssetsFileAsset78DA11727",
                  "Arn",
                ],
              },
            },
            Object {
              "Action": Array [
                "codebuild:BatchGetBuilds",
                "codebuild:StartBuild",
                "codebuild:StopBuild",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissueappsnapshottestsAssetsFileAsset8FB8D86DA",
                  "Arn",
                ],
              },
            },
            Object {
              "Action": Array [
                "codebuild:BatchGetBuilds",
                "codebuild:StartBuild",
                "codebuild:StopBuild",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissueappsnapshottestsAssetsFileAsset9EA490E16",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "irmaissueappsnapshottestsCodeBuildActionRoleDefaultPolicy00787E5E",
        "Roles": Array [
          Object {
            "Ref": "irmaissueappsnapshottestsCodeBuildActionRole6E969778",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "irmaissueappsnapshottestsPipelineArtifactsBucketD339BDC8": Object {
      "DeletionPolicy": "Retain",
      "Properties": Object {
        "BucketEncryption": Object {
          "ServerSideEncryptionConfiguration": Array [
            Object {
              "ServerSideEncryptionByDefault": Object {
                "KMSMasterKeyID": Object {
                  "Fn::GetAtt": Array [
                    "irmaissueappsnapshottestsPipelineArtifactsBucketEncryptionKeyEA37D987",
                    "Arn",
                  ],
                },
                "SSEAlgorithm": "aws:kms",
              },
            },
          ],
        },
        "PublicAccessBlockConfiguration": Object {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true,
        },
        "Tags": Array [
          Object {
            "Key": "cdkManaged",
            "Value": "yes",
          },
          Object {
            "Key": "Project",
            "Value": "irma-issue-app",
          },
        ],
      },
      "Type": "AWS::S3::Bucket",
      "UpdateReplacePolicy": "Retain",
    },
    "irmaissueappsnapshottestsPipelineArtifactsBucketEncryptionKeyAlias7C0B8931": Object {
      "DeletionPolicy": "Delete",
      "Properties": Object {
        "AliasName": "alias/codepipeline-testirmaissueappsnapshottestspipelined8c74ad2",
        "TargetKeyId": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsPipelineArtifactsBucketEncryptionKeyEA37D987",
            "Arn",
          ],
        },
      },
      "Type": "AWS::KMS::Alias",
      "UpdateReplacePolicy": "Delete",
    },
    "irmaissueappsnapshottestsPipelineArtifactsBucketEncryptionKeyEA37D987": Object {
      "DeletionPolicy": "Delete",
      "Properties": Object {
        "KeyPolicy": Object {
          "Statement": Array [
            Object {
              "Action": "kms:*",
              "Effect": "Allow",
              "Principal": Object {
                "AWS": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::test:root",
                    ],
                  ],
                },
              },
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "Tags": Array [
          Object {
            "Key": "cdkManaged",
            "Value": "yes",
          },
          Object {
            "Key": "Project",
            "Value": "irma-issue-app",
          },
        ],
      },
      "Type": "AWS::KMS::Key",
      "UpdateReplacePolicy": "Delete",
    },
    "irmaissueappsnapshottestsPipelineArtifactsBucketPolicy79B269A4": Object {
      "Properties": Object {
        "Bucket": Object {
          "Ref": "irmaissueappsnapshottestsPipelineArtifactsBucketD339BDC8",
        },
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "s3:*",
              "Condition": Object {
                "Bool": Object {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": Object {
                "AWS": "*",
              },
              "Resource": Array [
                Object {
                  "Fn::GetAtt": Array [
                    "irmaissueappsnapshottestsPipelineArtifactsBucketD339BDC8",
                    "Arn",
                  ],
                },
                Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      Object {
                        "Fn::GetAtt": Array [
                          "irmaissueappsnapshottestsPipelineArtifactsBucketD339BDC8",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::S3::BucketPolicy",
    },
    "irmaissueappsnapshottestsPipelineBuildSynthCdkBuildProject0ED6A888": Object {
      "Properties": Object {
        "Artifacts": Object {
          "Type": "CODEPIPELINE",
        },
        "Cache": Object {
          "Type": "NO_CACHE",
        },
        "Description": "Pipeline step test/Pipeline/Build/Synth",
        "EncryptionKey": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsPipelineArtifactsBucketEncryptionKeyEA37D987",
            "Arn",
          ],
        },
        "Environment": Object {
          "ComputeType": "BUILD_GENERAL1_SMALL",
          "EnvironmentVariables": Array [
            Object {
              "Name": "BRANCH_NAME",
              "Type": "PLAINTEXT",
              "Value": "snapshot-tests",
            },
          ],
          "Image": "aws/codebuild/standard:5.0",
          "ImagePullCredentialsType": "CODEBUILD",
          "PrivilegedMode": true,
          "Type": "LINUX_CONTAINER",
        },
        "ServiceRole": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsPipelineBuildSynthCdkBuildProjectRoleC546173F",
            "Arn",
          ],
        },
        "Source": Object {
          "BuildSpec": "{
  \\"version\\": \\"0.2\\",
  \\"phases\\": {
    \\"build\\": {
      \\"commands\\": [
        \\"yarn install --frozen-lockfile\\",
        \\"npx projen build\\",
        \\"npx projen synth\\"
      ]
    }
  },
  \\"artifacts\\": {
    \\"base-directory\\": \\"cdk.out\\",
    \\"files\\": \\"**/*\\"
  }
}",
          "Type": "CODEPIPELINE",
        },
        "Tags": Array [
          Object {
            "Key": "cdkManaged",
            "Value": "yes",
          },
          Object {
            "Key": "Project",
            "Value": "irma-issue-app",
          },
        ],
      },
      "Type": "AWS::CodeBuild::Project",
    },
    "irmaissueappsnapshottestsPipelineBuildSynthCdkBuildProjectRoleC546173F": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "codebuild.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Tags": Array [
          Object {
            "Key": "cdkManaged",
            "Value": "yes",
          },
          Object {
            "Key": "Project",
            "Value": "irma-issue-app",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "irmaissueappsnapshottestsPipelineBuildSynthCdkBuildProjectRoleDefaultPolicy181ED298": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": Array [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": Array [
                Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":logs:eu-west-1:test:log-group:/aws/codebuild/",
                      Object {
                        "Ref": "irmaissueappsnapshottestsPipelineBuildSynthCdkBuildProject0ED6A888",
                      },
                    ],
                  ],
                },
                Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":logs:eu-west-1:test:log-group:/aws/codebuild/",
                      Object {
                        "Ref": "irmaissueappsnapshottestsPipelineBuildSynthCdkBuildProject0ED6A888",
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
            Object {
              "Action": Array [
                "codebuild:CreateReportGroup",
                "codebuild:CreateReport",
                "codebuild:UpdateReport",
                "codebuild:BatchPutTestCases",
                "codebuild:BatchPutCodeCoverages",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::Join": Array [
                  "",
                  Array [
                    "arn:",
                    Object {
                      "Ref": "AWS::Partition",
                    },
                    ":codebuild:eu-west-1:test:report-group/",
                    Object {
                      "Ref": "irmaissueappsnapshottestsPipelineBuildSynthCdkBuildProject0ED6A888",
                    },
                    "-*",
                  ],
                ],
              },
            },
            Object {
              "Action": Array [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": Array [
                Object {
                  "Fn::GetAtt": Array [
                    "irmaissueappsnapshottestsPipelineArtifactsBucketD339BDC8",
                    "Arn",
                  ],
                },
                Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      Object {
                        "Fn::GetAtt": Array [
                          "irmaissueappsnapshottestsPipelineArtifactsBucketD339BDC8",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            Object {
              "Action": Array [
                "kms:Decrypt",
                "kms:DescribeKey",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissueappsnapshottestsPipelineArtifactsBucketEncryptionKeyEA37D987",
                  "Arn",
                ],
              },
            },
            Object {
              "Action": Array [
                "kms:Decrypt",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissueappsnapshottestsPipelineArtifactsBucketEncryptionKeyEA37D987",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "irmaissueappsnapshottestsPipelineBuildSynthCdkBuildProjectRoleDefaultPolicy181ED298",
        "Roles": Array [
          Object {
            "Ref": "irmaissueappsnapshottestsPipelineBuildSynthCdkBuildProjectRoleC546173F",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "irmaissueappsnapshottestsPipelineCD2018D8": Object {
      "DependsOn": Array [
        "irmaissueappsnapshottestsPipelineRoleDefaultPolicyE82280A6",
        "irmaissueappsnapshottestsPipelineRoleA001089D",
      ],
      "Properties": Object {
        "ArtifactStores": Array [
          Object {
            "ArtifactStore": Object {
              "EncryptionKey": Object {
                "Id": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":kms:eu-central-1:test:alias/entral-1tencryptionaliasc61f42e15f71f7b330df",
                    ],
                  ],
                },
                "Type": "KMS",
              },
              "Location": "test-support-eu-central-1eplicationbucketba99dc76aa175940ed5d",
              "Type": "S3",
            },
            "Region": "eu-central-1",
          },
          Object {
            "ArtifactStore": Object {
              "EncryptionKey": Object {
                "Id": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":kms:us-east-1:test:alias/s-east-1tencryptionalias106a6c2b35b2e6e195df",
                    ],
                  ],
                },
                "Type": "KMS",
              },
              "Location": "test-support-us-east-1eplicationbucketc55ea03e6eea3c55aca9",
              "Type": "S3",
            },
            "Region": "us-east-1",
          },
          Object {
            "ArtifactStore": Object {
              "EncryptionKey": Object {
                "Id": Object {
                  "Fn::GetAtt": Array [
                    "irmaissueappsnapshottestsPipelineArtifactsBucketEncryptionKeyEA37D987",
                    "Arn",
                  ],
                },
                "Type": "KMS",
              },
              "Location": Object {
                "Ref": "irmaissueappsnapshottestsPipelineArtifactsBucketD339BDC8",
              },
              "Type": "S3",
            },
            "Region": "eu-west-1",
          },
        ],
        "Name": "irma-issue-app-snapshot-tests",
        "RestartExecutionOnUpdate": true,
        "RoleArn": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsPipelineRoleA001089D",
            "Arn",
          ],
        },
        "Stages": Array [
          Object {
            "Actions": Array [
              Object {
                "ActionTypeId": Object {
                  "Category": "Source",
                  "Owner": "AWS",
                  "Provider": "CodeStarSourceConnection",
                  "Version": "1",
                },
                "Configuration": Object {
                  "BranchName": "snapshot-tests",
                  "ConnectionArn": "arn:CodeStarConnection:12124253124:blablab",
                  "FullRepositoryId": "GemeenteNijmegen/irma-issue-app",
                },
                "Name": "GemeenteNijmegen_irma-issue-app",
                "OutputArtifacts": Array [
                  Object {
                    "Name": "GemeenteNijmegen_irma_issue_app_Source",
                  },
                ],
                "RoleArn": Object {
                  "Fn::GetAtt": Array [
                    "irmaissueappsnapshottestsPipelineSourceGemeenteNijmegenirmaissueappCodePipelineActionRoleE74F7C04",
                    "Arn",
                  ],
                },
                "RunOrder": 1,
              },
            ],
            "Name": "Source",
          },
          Object {
            "Actions": Array [
              Object {
                "ActionTypeId": Object {
                  "Category": "Build",
                  "Owner": "AWS",
                  "Provider": "CodeBuild",
                  "Version": "1",
                },
                "Configuration": Object {
                  "EnvironmentVariables": "[{\\"name\\":\\"_PROJECT_CONFIG_HASH\\",\\"type\\":\\"PLAINTEXT\\",\\"value\\":\\"60e46c9806e04c9ac6425c705a3d4dc6840131b9414d2324452bbfdacca48be3\\"}]",
                  "ProjectName": Object {
                    "Ref": "irmaissueappsnapshottestsPipelineBuildSynthCdkBuildProject0ED6A888",
                  },
                },
                "InputArtifacts": Array [
                  Object {
                    "Name": "GemeenteNijmegen_irma_issue_app_Source",
                  },
                ],
                "Name": "Synth",
                "OutputArtifacts": Array [
                  Object {
                    "Name": "Synth_Output",
                  },
                ],
                "RoleArn": Object {
                  "Fn::GetAtt": Array [
                    "irmaissueappsnapshottestsCodeBuildActionRole6E969778",
                    "Arn",
                  ],
                },
                "RunOrder": 1,
              },
            ],
            "Name": "Build",
          },
          Object {
            "Actions": Array [
              Object {
                "ActionTypeId": Object {
                  "Category": "Build",
                  "Owner": "AWS",
                  "Provider": "CodeBuild",
                  "Version": "1",
                },
                "Configuration": Object {
                  "EnvironmentVariables": "[{\\"name\\":\\"_PROJECT_CONFIG_HASH\\",\\"type\\":\\"PLAINTEXT\\",\\"value\\":\\"3da127aa189deb54d8c0980cc729eac900f60d30510349b54f3361e2131edba9\\"}]",
                  "ProjectName": Object {
                    "Ref": "irmaissueappsnapshottestsUpdatePipelineSelfMutation94934255",
                  },
                },
                "InputArtifacts": Array [
                  Object {
                    "Name": "Synth_Output",
                  },
                ],
                "Name": "SelfMutate",
                "RoleArn": Object {
                  "Fn::GetAtt": Array [
                    "irmaissueappsnapshottestsCodeBuildActionRole6E969778",
                    "Arn",
                  ],
                },
                "RunOrder": 1,
              },
            ],
            "Name": "UpdatePipeline",
          },
          Object {
            "Actions": Array [
              Object {
                "ActionTypeId": Object {
                  "Category": "Build",
                  "Owner": "AWS",
                  "Provider": "CodeBuild",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ProjectName": Object {
                    "Ref": "irmaissueappsnapshottestsAssetsFileAsset11EF7834D",
                  },
                },
                "InputArtifacts": Array [
                  Object {
                    "Name": "Synth_Output",
                  },
                ],
                "Name": "FileAsset1",
                "RoleArn": Object {
                  "Fn::GetAtt": Array [
                    "irmaissueappsnapshottestsCodeBuildActionRole6E969778",
                    "Arn",
                  ],
                },
                "RunOrder": 1,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Build",
                  "Owner": "AWS",
                  "Provider": "CodeBuild",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ProjectName": Object {
                    "Ref": "irmaissueappsnapshottestsAssetsFileAsset10F465841C",
                  },
                },
                "InputArtifacts": Array [
                  Object {
                    "Name": "Synth_Output",
                  },
                ],
                "Name": "FileAsset10",
                "RoleArn": Object {
                  "Fn::GetAtt": Array [
                    "irmaissueappsnapshottestsCodeBuildActionRole6E969778",
                    "Arn",
                  ],
                },
                "RunOrder": 1,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Build",
                  "Owner": "AWS",
                  "Provider": "CodeBuild",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ProjectName": Object {
                    "Ref": "irmaissueappsnapshottestsAssetsFileAsset11C35B121E",
                  },
                },
                "InputArtifacts": Array [
                  Object {
                    "Name": "Synth_Output",
                  },
                ],
                "Name": "FileAsset11",
                "RoleArn": Object {
                  "Fn::GetAtt": Array [
                    "irmaissueappsnapshottestsCodeBuildActionRole6E969778",
                    "Arn",
                  ],
                },
                "RunOrder": 1,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Build",
                  "Owner": "AWS",
                  "Provider": "CodeBuild",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ProjectName": Object {
                    "Ref": "irmaissueappsnapshottestsAssetsFileAsset1263AA13EC",
                  },
                },
                "InputArtifacts": Array [
                  Object {
                    "Name": "Synth_Output",
                  },
                ],
                "Name": "FileAsset12",
                "RoleArn": Object {
                  "Fn::GetAtt": Array [
                    "irmaissueappsnapshottestsCodeBuildActionRole6E969778",
                    "Arn",
                  ],
                },
                "RunOrder": 1,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Build",
                  "Owner": "AWS",
                  "Provider": "CodeBuild",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ProjectName": Object {
                    "Ref": "irmaissueappsnapshottestsAssetsFileAsset2B38A383A",
                  },
                },
                "InputArtifacts": Array [
                  Object {
                    "Name": "Synth_Output",
                  },
                ],
                "Name": "FileAsset2",
                "RoleArn": Object {
                  "Fn::GetAtt": Array [
                    "irmaissueappsnapshottestsCodeBuildActionRole6E969778",
                    "Arn",
                  ],
                },
                "RunOrder": 1,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Build",
                  "Owner": "AWS",
                  "Provider": "CodeBuild",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ProjectName": Object {
                    "Ref": "irmaissueappsnapshottestsAssetsFileAsset3747F7373",
                  },
                },
                "InputArtifacts": Array [
                  Object {
                    "Name": "Synth_Output",
                  },
                ],
                "Name": "FileAsset3",
                "RoleArn": Object {
                  "Fn::GetAtt": Array [
                    "irmaissueappsnapshottestsCodeBuildActionRole6E969778",
                    "Arn",
                  ],
                },
                "RunOrder": 1,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Build",
                  "Owner": "AWS",
                  "Provider": "CodeBuild",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ProjectName": Object {
                    "Ref": "irmaissueappsnapshottestsAssetsFileAsset403983B77",
                  },
                },
                "InputArtifacts": Array [
                  Object {
                    "Name": "Synth_Output",
                  },
                ],
                "Name": "FileAsset4",
                "RoleArn": Object {
                  "Fn::GetAtt": Array [
                    "irmaissueappsnapshottestsCodeBuildActionRole6E969778",
                    "Arn",
                  ],
                },
                "RunOrder": 1,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Build",
                  "Owner": "AWS",
                  "Provider": "CodeBuild",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ProjectName": Object {
                    "Ref": "irmaissueappsnapshottestsAssetsFileAsset529E787FE",
                  },
                },
                "InputArtifacts": Array [
                  Object {
                    "Name": "Synth_Output",
                  },
                ],
                "Name": "FileAsset5",
                "RoleArn": Object {
                  "Fn::GetAtt": Array [
                    "irmaissueappsnapshottestsCodeBuildActionRole6E969778",
                    "Arn",
                  ],
                },
                "RunOrder": 1,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Build",
                  "Owner": "AWS",
                  "Provider": "CodeBuild",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ProjectName": Object {
                    "Ref": "irmaissueappsnapshottestsAssetsFileAsset61692BDD4",
                  },
                },
                "InputArtifacts": Array [
                  Object {
                    "Name": "Synth_Output",
                  },
                ],
                "Name": "FileAsset6",
                "RoleArn": Object {
                  "Fn::GetAtt": Array [
                    "irmaissueappsnapshottestsCodeBuildActionRole6E969778",
                    "Arn",
                  ],
                },
                "RunOrder": 1,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Build",
                  "Owner": "AWS",
                  "Provider": "CodeBuild",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ProjectName": Object {
                    "Ref": "irmaissueappsnapshottestsAssetsFileAsset78DA11727",
                  },
                },
                "InputArtifacts": Array [
                  Object {
                    "Name": "Synth_Output",
                  },
                ],
                "Name": "FileAsset7",
                "RoleArn": Object {
                  "Fn::GetAtt": Array [
                    "irmaissueappsnapshottestsCodeBuildActionRole6E969778",
                    "Arn",
                  ],
                },
                "RunOrder": 1,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Build",
                  "Owner": "AWS",
                  "Provider": "CodeBuild",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ProjectName": Object {
                    "Ref": "irmaissueappsnapshottestsAssetsFileAsset8FB8D86DA",
                  },
                },
                "InputArtifacts": Array [
                  Object {
                    "Name": "Synth_Output",
                  },
                ],
                "Name": "FileAsset8",
                "RoleArn": Object {
                  "Fn::GetAtt": Array [
                    "irmaissueappsnapshottestsCodeBuildActionRole6E969778",
                    "Arn",
                  ],
                },
                "RunOrder": 1,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Build",
                  "Owner": "AWS",
                  "Provider": "CodeBuild",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ProjectName": Object {
                    "Ref": "irmaissueappsnapshottestsAssetsFileAsset9EA490E16",
                  },
                },
                "InputArtifacts": Array [
                  Object {
                    "Name": "Synth_Output",
                  },
                ],
                "Name": "FileAsset9",
                "RoleArn": Object {
                  "Fn::GetAtt": Array [
                    "irmaissueappsnapshottestsCodeBuildActionRole6E969778",
                    "Arn",
                  ],
                },
                "RunOrder": 1,
              },
            ],
            "Name": "Assets",
          },
          Object {
            "Actions": Array [
              Object {
                "ActionTypeId": Object {
                  "Category": "Deploy",
                  "Owner": "AWS",
                  "Provider": "CloudFormation",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ActionMode": "CHANGE_SET_REPLACE",
                  "Capabilities": "CAPABILITY_NAMED_IAM,CAPABILITY_AUTO_EXPAND",
                  "ChangeSetName": "PipelineChange",
                  "RoleArn": Object {
                    "Fn::Join": Array [
                      "",
                      Array [
                        "arn:",
                        Object {
                          "Ref": "AWS::Partition",
                        },
                        ":iam::123456789012:role/cdk-hnb659fds-cfn-exec-role-123456789012-eu-central-1",
                      ],
                    ],
                  },
                  "StackName": "irma-issue-parameters-params",
                  "TemplateConfiguration": "Synth_Output::assembly-test-irma-issue-parameters/testirmaissueparametersparamsC5805D0D.template.json.config.json",
                  "TemplatePath": "Synth_Output::assembly-test-irma-issue-parameters/testirmaissueparametersparamsC5805D0D.template.json",
                },
                "InputArtifacts": Array [
                  Object {
                    "Name": "Synth_Output",
                  },
                ],
                "Name": "Prepare",
                "Region": "eu-central-1",
                "RoleArn": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::123456789012:role/cdk-hnb659fds-deploy-role-123456789012-eu-central-1",
                    ],
                  ],
                },
                "RunOrder": 1,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Deploy",
                  "Owner": "AWS",
                  "Provider": "CloudFormation",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ActionMode": "CHANGE_SET_EXECUTE",
                  "ChangeSetName": "PipelineChange",
                  "StackName": "irma-issue-parameters-params",
                },
                "Name": "Deploy",
                "Region": "eu-central-1",
                "RoleArn": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::123456789012:role/cdk-hnb659fds-deploy-role-123456789012-eu-central-1",
                    ],
                  ],
                },
                "RunOrder": 2,
              },
            ],
            "Name": "irma-issue-parameters",
          },
          Object {
            "Actions": Array [
              Object {
                "ActionTypeId": Object {
                  "Category": "Deploy",
                  "Owner": "AWS",
                  "Provider": "CloudFormation",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ActionMode": "CHANGE_SET_REPLACE",
                  "Capabilities": "CAPABILITY_NAMED_IAM,CAPABILITY_AUTO_EXPAND",
                  "ChangeSetName": "PipelineChange",
                  "RoleArn": Object {
                    "Fn::Join": Array [
                      "",
                      Array [
                        "arn:",
                        Object {
                          "Ref": "AWS::Partition",
                        },
                        ":iam::123456789012:role/cdk-hnb659fds-cfn-exec-role-123456789012-eu-central-1",
                      ],
                    ],
                  },
                  "StackName": "irma-issue-api-dns-stack",
                  "TemplatePath": "Synth_Output::assembly-test-irma-issue-api/testirmaissueapidnsstack95AEA48A.template.json",
                },
                "InputArtifacts": Array [
                  Object {
                    "Name": "Synth_Output",
                  },
                ],
                "Name": "dns-stack.Prepare",
                "Region": "eu-central-1",
                "RoleArn": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::123456789012:role/cdk-hnb659fds-deploy-role-123456789012-eu-central-1",
                    ],
                  ],
                },
                "RunOrder": 1,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Deploy",
                  "Owner": "AWS",
                  "Provider": "CloudFormation",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ActionMode": "CHANGE_SET_REPLACE",
                  "Capabilities": "CAPABILITY_NAMED_IAM,CAPABILITY_AUTO_EXPAND",
                  "ChangeSetName": "PipelineChange",
                  "RoleArn": Object {
                    "Fn::Join": Array [
                      "",
                      Array [
                        "arn:",
                        Object {
                          "Ref": "AWS::Partition",
                        },
                        ":iam::123456789012:role/cdk-hnb659fds-cfn-exec-role-123456789012-eu-central-1",
                      ],
                    ],
                  },
                  "StackName": "irma-issue-api-key-stack",
                  "TemplatePath": "Synth_Output::assembly-test-irma-issue-api/testirmaissueapikeystackCEA0DFB6.template.json",
                },
                "InputArtifacts": Array [
                  Object {
                    "Name": "Synth_Output",
                  },
                ],
                "Name": "key-stack.Prepare",
                "Region": "eu-central-1",
                "RoleArn": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::123456789012:role/cdk-hnb659fds-deploy-role-123456789012-eu-central-1",
                    ],
                  ],
                },
                "RunOrder": 1,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Deploy",
                  "Owner": "AWS",
                  "Provider": "CloudFormation",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ActionMode": "CHANGE_SET_EXECUTE",
                  "ChangeSetName": "PipelineChange",
                  "StackName": "irma-issue-api-dns-stack",
                },
                "Name": "dns-stack.Deploy",
                "Region": "eu-central-1",
                "RoleArn": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::123456789012:role/cdk-hnb659fds-deploy-role-123456789012-eu-central-1",
                    ],
                  ],
                },
                "RunOrder": 2,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Deploy",
                  "Owner": "AWS",
                  "Provider": "CloudFormation",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ActionMode": "CHANGE_SET_EXECUTE",
                  "ChangeSetName": "PipelineChange",
                  "StackName": "irma-issue-api-key-stack",
                },
                "Name": "key-stack.Deploy",
                "Region": "eu-central-1",
                "RoleArn": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::123456789012:role/cdk-hnb659fds-deploy-role-123456789012-eu-central-1",
                    ],
                  ],
                },
                "RunOrder": 2,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Deploy",
                  "Owner": "AWS",
                  "Provider": "CloudFormation",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ActionMode": "CHANGE_SET_REPLACE",
                  "Capabilities": "CAPABILITY_NAMED_IAM,CAPABILITY_AUTO_EXPAND",
                  "ChangeSetName": "PipelineChange",
                  "RoleArn": Object {
                    "Fn::Join": Array [
                      "",
                      Array [
                        "arn:",
                        Object {
                          "Ref": "AWS::Partition",
                        },
                        ":iam::123456789012:role/cdk-hnb659fds-cfn-exec-role-123456789012-us-east-1",
                      ],
                    ],
                  },
                  "StackName": "irma-issue-api-dnssec-stack",
                  "TemplatePath": "Synth_Output::assembly-test-irma-issue-api/testirmaissueapidnssecstack22548CE5.template.json",
                },
                "InputArtifacts": Array [
                  Object {
                    "Name": "Synth_Output",
                  },
                ],
                "Name": "dnssec-stack.Prepare",
                "Region": "us-east-1",
                "RoleArn": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::123456789012:role/cdk-hnb659fds-deploy-role-123456789012-us-east-1",
                    ],
                  ],
                },
                "RunOrder": 3,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Deploy",
                  "Owner": "AWS",
                  "Provider": "CloudFormation",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ActionMode": "CHANGE_SET_REPLACE",
                  "Capabilities": "CAPABILITY_NAMED_IAM,CAPABILITY_AUTO_EXPAND",
                  "ChangeSetName": "PipelineChange",
                  "RoleArn": Object {
                    "Fn::Join": Array [
                      "",
                      Array [
                        "arn:",
                        Object {
                          "Ref": "AWS::Partition",
                        },
                        ":iam::123456789012:role/cdk-hnb659fds-cfn-exec-role-123456789012-eu-central-1",
                      ],
                    ],
                  },
                  "StackName": "irma-issue-api-sessions-stack",
                  "TemplatePath": "Synth_Output::assembly-test-irma-issue-api/testirmaissueapisessionsstack8BDEDEB9.template.json",
                },
                "InputArtifacts": Array [
                  Object {
                    "Name": "Synth_Output",
                  },
                ],
                "Name": "sessions-stack.Prepare",
                "Region": "eu-central-1",
                "RoleArn": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::123456789012:role/cdk-hnb659fds-deploy-role-123456789012-eu-central-1",
                    ],
                  ],
                },
                "RunOrder": 3,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Deploy",
                  "Owner": "AWS",
                  "Provider": "CloudFormation",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ActionMode": "CHANGE_SET_REPLACE",
                  "Capabilities": "CAPABILITY_NAMED_IAM,CAPABILITY_AUTO_EXPAND",
                  "ChangeSetName": "PipelineChange",
                  "RoleArn": Object {
                    "Fn::Join": Array [
                      "",
                      Array [
                        "arn:",
                        Object {
                          "Ref": "AWS::Partition",
                        },
                        ":iam::123456789012:role/cdk-hnb659fds-cfn-exec-role-123456789012-us-east-1",
                      ],
                    ],
                  },
                  "StackName": "irma-issue-api-us-cert-stack",
                  "TemplatePath": "Synth_Output::assembly-test-irma-issue-api/testirmaissueapiuscertstack39194015.template.json",
                },
                "InputArtifacts": Array [
                  Object {
                    "Name": "Synth_Output",
                  },
                ],
                "Name": "us-cert-stack.Prepare",
                "Region": "us-east-1",
                "RoleArn": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::123456789012:role/cdk-hnb659fds-deploy-role-123456789012-us-east-1",
                    ],
                  ],
                },
                "RunOrder": 3,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Deploy",
                  "Owner": "AWS",
                  "Provider": "CloudFormation",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ActionMode": "CHANGE_SET_EXECUTE",
                  "ChangeSetName": "PipelineChange",
                  "StackName": "irma-issue-api-dnssec-stack",
                },
                "Name": "dnssec-stack.Deploy",
                "Region": "us-east-1",
                "RoleArn": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::123456789012:role/cdk-hnb659fds-deploy-role-123456789012-us-east-1",
                    ],
                  ],
                },
                "RunOrder": 4,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Deploy",
                  "Owner": "AWS",
                  "Provider": "CloudFormation",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ActionMode": "CHANGE_SET_EXECUTE",
                  "ChangeSetName": "PipelineChange",
                  "StackName": "irma-issue-api-sessions-stack",
                },
                "Name": "sessions-stack.Deploy",
                "Region": "eu-central-1",
                "RoleArn": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::123456789012:role/cdk-hnb659fds-deploy-role-123456789012-eu-central-1",
                    ],
                  ],
                },
                "RunOrder": 4,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Deploy",
                  "Owner": "AWS",
                  "Provider": "CloudFormation",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ActionMode": "CHANGE_SET_EXECUTE",
                  "ChangeSetName": "PipelineChange",
                  "StackName": "irma-issue-api-us-cert-stack",
                },
                "Name": "us-cert-stack.Deploy",
                "Region": "us-east-1",
                "RoleArn": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::123456789012:role/cdk-hnb659fds-deploy-role-123456789012-us-east-1",
                    ],
                  ],
                },
                "RunOrder": 4,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Deploy",
                  "Owner": "AWS",
                  "Provider": "CloudFormation",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ActionMode": "CHANGE_SET_REPLACE",
                  "Capabilities": "CAPABILITY_NAMED_IAM,CAPABILITY_AUTO_EXPAND",
                  "ChangeSetName": "PipelineChange",
                  "RoleArn": Object {
                    "Fn::Join": Array [
                      "",
                      Array [
                        "arn:",
                        Object {
                          "Ref": "AWS::Partition",
                        },
                        ":iam::123456789012:role/cdk-hnb659fds-cfn-exec-role-123456789012-eu-central-1",
                      ],
                    ],
                  },
                  "StackName": "irma-issue-api-api-stack",
                  "TemplatePath": "Synth_Output::assembly-test-irma-issue-api/testirmaissueapiapistack38F434B4.template.json",
                },
                "InputArtifacts": Array [
                  Object {
                    "Name": "Synth_Output",
                  },
                ],
                "Name": "api-stack.Prepare",
                "Region": "eu-central-1",
                "RoleArn": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::123456789012:role/cdk-hnb659fds-deploy-role-123456789012-eu-central-1",
                    ],
                  ],
                },
                "RunOrder": 5,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Deploy",
                  "Owner": "AWS",
                  "Provider": "CloudFormation",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ActionMode": "CHANGE_SET_EXECUTE",
                  "ChangeSetName": "PipelineChange",
                  "StackName": "irma-issue-api-api-stack",
                },
                "Name": "api-stack.Deploy",
                "Region": "eu-central-1",
                "RoleArn": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::123456789012:role/cdk-hnb659fds-deploy-role-123456789012-eu-central-1",
                    ],
                  ],
                },
                "RunOrder": 6,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Deploy",
                  "Owner": "AWS",
                  "Provider": "CloudFormation",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ActionMode": "CHANGE_SET_REPLACE",
                  "Capabilities": "CAPABILITY_NAMED_IAM,CAPABILITY_AUTO_EXPAND",
                  "ChangeSetName": "PipelineChange",
                  "RoleArn": Object {
                    "Fn::Join": Array [
                      "",
                      Array [
                        "arn:",
                        Object {
                          "Ref": "AWS::Partition",
                        },
                        ":iam::123456789012:role/cdk-hnb659fds-cfn-exec-role-123456789012-eu-central-1",
                      ],
                    ],
                  },
                  "StackName": "irma-issue-api-cloudfront-stack",
                  "TemplatePath": "Synth_Output::assembly-test-irma-issue-api/testirmaissueapicloudfrontstackE66D8EBF.template.json",
                },
                "InputArtifacts": Array [
                  Object {
                    "Name": "Synth_Output",
                  },
                ],
                "Name": "cloudfront-stack.Prepare",
                "Region": "eu-central-1",
                "RoleArn": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::123456789012:role/cdk-hnb659fds-deploy-role-123456789012-eu-central-1",
                    ],
                  ],
                },
                "RunOrder": 7,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Deploy",
                  "Owner": "AWS",
                  "Provider": "CloudFormation",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ActionMode": "CHANGE_SET_REPLACE",
                  "Capabilities": "CAPABILITY_NAMED_IAM,CAPABILITY_AUTO_EXPAND",
                  "ChangeSetName": "PipelineChange",
                  "RoleArn": Object {
                    "Fn::Join": Array [
                      "",
                      Array [
                        "arn:",
                        Object {
                          "Ref": "AWS::Partition",
                        },
                        ":iam::123456789012:role/cdk-hnb659fds-cfn-exec-role-123456789012-eu-central-1",
                      ],
                    ],
                  },
                  "StackName": "irma-issue-api-dashboard-stack",
                  "TemplatePath": "Synth_Output::assembly-test-irma-issue-api/testirmaissueapidashboardstackA2662528.template.json",
                },
                "InputArtifacts": Array [
                  Object {
                    "Name": "Synth_Output",
                  },
                ],
                "Name": "dashboard-stack.Prepare",
                "Region": "eu-central-1",
                "RoleArn": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::123456789012:role/cdk-hnb659fds-deploy-role-123456789012-eu-central-1",
                    ],
                  ],
                },
                "RunOrder": 7,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Deploy",
                  "Owner": "AWS",
                  "Provider": "CloudFormation",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ActionMode": "CHANGE_SET_REPLACE",
                  "Capabilities": "CAPABILITY_NAMED_IAM,CAPABILITY_AUTO_EXPAND",
                  "ChangeSetName": "PipelineChange",
                  "RoleArn": Object {
                    "Fn::Join": Array [
                      "",
                      Array [
                        "arn:",
                        Object {
                          "Ref": "AWS::Partition",
                        },
                        ":iam::123456789012:role/cdk-hnb659fds-cfn-exec-role-123456789012-us-east-1",
                      ],
                    ],
                  },
                  "StackName": "irma-issue-api-waf-stack",
                  "TemplatePath": "Synth_Output::assembly-test-irma-issue-api/testirmaissueapiwafstack8EC6AB40.template.json",
                },
                "InputArtifacts": Array [
                  Object {
                    "Name": "Synth_Output",
                  },
                ],
                "Name": "waf-stack.Prepare",
                "Region": "us-east-1",
                "RoleArn": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::123456789012:role/cdk-hnb659fds-deploy-role-123456789012-us-east-1",
                    ],
                  ],
                },
                "RunOrder": 7,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Deploy",
                  "Owner": "AWS",
                  "Provider": "CloudFormation",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ActionMode": "CHANGE_SET_EXECUTE",
                  "ChangeSetName": "PipelineChange",
                  "StackName": "irma-issue-api-cloudfront-stack",
                },
                "Name": "cloudfront-stack.Deploy",
                "Region": "eu-central-1",
                "RoleArn": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::123456789012:role/cdk-hnb659fds-deploy-role-123456789012-eu-central-1",
                    ],
                  ],
                },
                "RunOrder": 8,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Deploy",
                  "Owner": "AWS",
                  "Provider": "CloudFormation",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ActionMode": "CHANGE_SET_EXECUTE",
                  "ChangeSetName": "PipelineChange",
                  "StackName": "irma-issue-api-dashboard-stack",
                },
                "Name": "dashboard-stack.Deploy",
                "Region": "eu-central-1",
                "RoleArn": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::123456789012:role/cdk-hnb659fds-deploy-role-123456789012-eu-central-1",
                    ],
                  ],
                },
                "RunOrder": 8,
              },
              Object {
                "ActionTypeId": Object {
                  "Category": "Deploy",
                  "Owner": "AWS",
                  "Provider": "CloudFormation",
                  "Version": "1",
                },
                "Configuration": Object {
                  "ActionMode": "CHANGE_SET_EXECUTE",
                  "ChangeSetName": "PipelineChange",
                  "StackName": "irma-issue-api-waf-stack",
                },
                "Name": "waf-stack.Deploy",
                "Region": "us-east-1",
                "RoleArn": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::123456789012:role/cdk-hnb659fds-deploy-role-123456789012-us-east-1",
                    ],
                  ],
                },
                "RunOrder": 8,
              },
            ],
            "Name": "irma-issue-api",
          },
        ],
        "Tags": Array [
          Object {
            "Key": "cdkManaged",
            "Value": "yes",
          },
          Object {
            "Key": "Project",
            "Value": "irma-issue-app",
          },
        ],
      },
      "Type": "AWS::CodePipeline::Pipeline",
    },
    "irmaissueappsnapshottestsPipelineRoleA001089D": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "codepipeline.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Tags": Array [
          Object {
            "Key": "cdkManaged",
            "Value": "yes",
          },
          Object {
            "Key": "Project",
            "Value": "irma-issue-app",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "irmaissueappsnapshottestsPipelineRoleDefaultPolicyE82280A6": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": Array [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": Array [
                Object {
                  "Fn::GetAtt": Array [
                    "irmaissueappsnapshottestsPipelineArtifactsBucketD339BDC8",
                    "Arn",
                  ],
                },
                Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      Object {
                        "Fn::GetAtt": Array [
                          "irmaissueappsnapshottestsPipelineArtifactsBucketD339BDC8",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            Object {
              "Action": Array [
                "kms:Decrypt",
                "kms:DescribeKey",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissueappsnapshottestsPipelineArtifactsBucketEncryptionKeyEA37D987",
                  "Arn",
                ],
              },
            },
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissueappsnapshottestsPipelineSourceGemeenteNijmegenirmaissueappCodePipelineActionRoleE74F7C04",
                  "Arn",
                ],
              },
            },
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissueappsnapshottestsCodeBuildActionRole6E969778",
                  "Arn",
                ],
              },
            },
            Object {
              "Action": Array [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": Array [
                Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::test-support-eu-central-1eplicationbucketba99dc76aa175940ed5d",
                    ],
                  ],
                },
                Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::test-support-eu-central-1eplicationbucketba99dc76aa175940ed5d/*",
                    ],
                  ],
                },
              ],
            },
            Object {
              "Action": Array [
                "kms:Decrypt",
                "kms:DescribeKey",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Resource": Object {
                "Fn::Join": Array [
                  "",
                  Array [
                    "arn:",
                    Object {
                      "Ref": "AWS::Partition",
                    },
                    ":iam::123456789012:role/cdk-hnb659fds-deploy-role-123456789012-eu-central-1",
                  ],
                ],
              },
            },
            Object {
              "Action": Array [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": Array [
                Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::test-support-us-east-1eplicationbucketc55ea03e6eea3c55aca9",
                    ],
                  ],
                },
                Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::test-support-us-east-1eplicationbucketc55ea03e6eea3c55aca9/*",
                    ],
                  ],
                },
              ],
            },
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Resource": Object {
                "Fn::Join": Array [
                  "",
                  Array [
                    "arn:",
                    Object {
                      "Ref": "AWS::Partition",
                    },
                    ":iam::123456789012:role/cdk-hnb659fds-deploy-role-123456789012-us-east-1",
                  ],
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "irmaissueappsnapshottestsPipelineRoleDefaultPolicyE82280A6",
        "Roles": Array [
          Object {
            "Ref": "irmaissueappsnapshottestsPipelineRoleA001089D",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "irmaissueappsnapshottestsPipelineSourceGemeenteNijmegenirmaissueappCodePipelineActionRoleDefaultPolicy03FBE85B": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "codestar-connections:UseConnection",
              "Effect": "Allow",
              "Resource": "arn:CodeStarConnection:12124253124:blablab",
            },
            Object {
              "Action": Array [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": Array [
                Object {
                  "Fn::GetAtt": Array [
                    "irmaissueappsnapshottestsPipelineArtifactsBucketD339BDC8",
                    "Arn",
                  ],
                },
                Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      Object {
                        "Fn::GetAtt": Array [
                          "irmaissueappsnapshottestsPipelineArtifactsBucketD339BDC8",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            Object {
              "Action": Array [
                "kms:Decrypt",
                "kms:DescribeKey",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissueappsnapshottestsPipelineArtifactsBucketEncryptionKeyEA37D987",
                  "Arn",
                ],
              },
            },
            Object {
              "Action": Array [
                "s3:PutObjectAcl",
                "s3:PutObjectVersionAcl",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::Join": Array [
                  "",
                  Array [
                    Object {
                      "Fn::GetAtt": Array [
                        "irmaissueappsnapshottestsPipelineArtifactsBucketD339BDC8",
                        "Arn",
                      ],
                    },
                    "/*",
                  ],
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "irmaissueappsnapshottestsPipelineSourceGemeenteNijmegenirmaissueappCodePipelineActionRoleDefaultPolicy03FBE85B",
        "Roles": Array [
          Object {
            "Ref": "irmaissueappsnapshottestsPipelineSourceGemeenteNijmegenirmaissueappCodePipelineActionRoleE74F7C04",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "irmaissueappsnapshottestsPipelineSourceGemeenteNijmegenirmaissueappCodePipelineActionRoleE74F7C04": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "AWS": Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::test:root",
                    ],
                  ],
                },
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Tags": Array [
          Object {
            "Key": "cdkManaged",
            "Value": "yes",
          },
          Object {
            "Key": "Project",
            "Value": "irma-issue-app",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "irmaissueappsnapshottestsUpdatePipelineSelfMutation94934255": Object {
      "Properties": Object {
        "Artifacts": Object {
          "Type": "CODEPIPELINE",
        },
        "Cache": Object {
          "Type": "NO_CACHE",
        },
        "Description": "Pipeline step test/Pipeline/UpdatePipeline/SelfMutate",
        "EncryptionKey": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsPipelineArtifactsBucketEncryptionKeyEA37D987",
            "Arn",
          ],
        },
        "Environment": Object {
          "ComputeType": "BUILD_GENERAL1_SMALL",
          "Image": "aws/codebuild/standard:5.0",
          "ImagePullCredentialsType": "CODEBUILD",
          "PrivilegedMode": true,
          "Type": "LINUX_CONTAINER",
        },
        "Name": "irma-issue-app-snapshot-tests-selfupdate",
        "ServiceRole": Object {
          "Fn::GetAtt": Array [
            "irmaissueappsnapshottestsUpdatePipelineSelfMutationRole94BD23AD",
            "Arn",
          ],
        },
        "Source": Object {
          "BuildSpec": "{
  \\"version\\": \\"0.2\\",
  \\"phases\\": {
    \\"install\\": {
      \\"commands\\": [
        \\"npm install -g aws-cdk@2\\"
      ]
    },
    \\"build\\": {
      \\"commands\\": [
        \\"cdk -a . deploy test --require-approval=never --verbose\\"
      ]
    }
  }
}",
          "Type": "CODEPIPELINE",
        },
        "Tags": Array [
          Object {
            "Key": "cdkManaged",
            "Value": "yes",
          },
          Object {
            "Key": "Project",
            "Value": "irma-issue-app",
          },
        ],
      },
      "Type": "AWS::CodeBuild::Project",
    },
    "irmaissueappsnapshottestsUpdatePipelineSelfMutationRole94BD23AD": Object {
      "Properties": Object {
        "AssumeRolePolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": Object {
                "Service": "codebuild.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Tags": Array [
          Object {
            "Key": "cdkManaged",
            "Value": "yes",
          },
          Object {
            "Key": "Project",
            "Value": "irma-issue-app",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "irmaissueappsnapshottestsUpdatePipelineSelfMutationRoleDefaultPolicyFDED95AB": Object {
      "Properties": Object {
        "PolicyDocument": Object {
          "Statement": Array [
            Object {
              "Action": Array [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": Array [
                Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":logs:eu-west-1:test:log-group:/aws/codebuild/",
                      Object {
                        "Ref": "irmaissueappsnapshottestsUpdatePipelineSelfMutation94934255",
                      },
                    ],
                  ],
                },
                Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      "arn:",
                      Object {
                        "Ref": "AWS::Partition",
                      },
                      ":logs:eu-west-1:test:log-group:/aws/codebuild/",
                      Object {
                        "Ref": "irmaissueappsnapshottestsUpdatePipelineSelfMutation94934255",
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
            Object {
              "Action": Array [
                "codebuild:CreateReportGroup",
                "codebuild:CreateReport",
                "codebuild:UpdateReport",
                "codebuild:BatchPutTestCases",
                "codebuild:BatchPutCodeCoverages",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::Join": Array [
                  "",
                  Array [
                    "arn:",
                    Object {
                      "Ref": "AWS::Partition",
                    },
                    ":codebuild:eu-west-1:test:report-group/",
                    Object {
                      "Ref": "irmaissueappsnapshottestsUpdatePipelineSelfMutation94934255",
                    },
                    "-*",
                  ],
                ],
              },
            },
            Object {
              "Action": "sts:AssumeRole",
              "Condition": Object {
                "ForAnyValue:StringEquals": Object {
                  "iam:ResourceTag/aws-cdk:bootstrap-role": Array [
                    "image-publishing",
                    "file-publishing",
                    "deploy",
                  ],
                },
              },
              "Effect": "Allow",
              "Resource": "arn:*:iam::test:role/*",
            },
            Object {
              "Action": "cloudformation:DescribeStacks",
              "Effect": "Allow",
              "Resource": "*",
            },
            Object {
              "Action": "s3:ListBucket",
              "Effect": "Allow",
              "Resource": "*",
            },
            Object {
              "Action": Array [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
              ],
              "Effect": "Allow",
              "Resource": Array [
                Object {
                  "Fn::GetAtt": Array [
                    "irmaissueappsnapshottestsPipelineArtifactsBucketD339BDC8",
                    "Arn",
                  ],
                },
                Object {
                  "Fn::Join": Array [
                    "",
                    Array [
                      Object {
                        "Fn::GetAtt": Array [
                          "irmaissueappsnapshottestsPipelineArtifactsBucketD339BDC8",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            Object {
              "Action": Array [
                "kms:Decrypt",
                "kms:DescribeKey",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissueappsnapshottestsPipelineArtifactsBucketEncryptionKeyEA37D987",
                  "Arn",
                ],
              },
            },
            Object {
              "Action": Array [
                "kms:Decrypt",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": Object {
                "Fn::GetAtt": Array [
                  "irmaissueappsnapshottestsPipelineArtifactsBucketEncryptionKeyEA37D987",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "irmaissueappsnapshottestsUpdatePipelineSelfMutationRoleDefaultPolicyFDED95AB",
        "Roles": Array [
          Object {
            "Ref": "irmaissueappsnapshottestsUpdatePipelineSelfMutationRole94BD23AD",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
  },
  "Rules": Object {
    "CheckBootstrapVersion": Object {
      "Assertions": Array [
        Object {
          "Assert": Object {
            "Fn::Not": Array [
              Object {
                "Fn::Contains": Array [
                  Array [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  Object {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;
